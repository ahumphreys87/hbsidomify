exports.__esModule = true;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

/*globals module, URL*/

var _htmlbarsRuntimeMorph = require("./htmlbars-runtime/morph");

var _htmlbarsRuntimeMorph2 = _interopRequireDefault(_htmlbarsRuntimeMorph);

var _morphAttr = require("./morph-attr");

var _morphAttr2 = _interopRequireDefault(_morphAttr);

var _domHelperBuildHtmlDom = require("./dom-helper/build-html-dom");

var _domHelperClasses = require("./dom-helper/classes");

var _domHelperProp = require("./dom-helper/prop");

var doc = typeof document === 'undefined' ? false : document;

var deletesBlankTextNodes = doc && (function (document) {
  var element = document.createElement('div');
  element.appendChild(document.createTextNode(''));
  var clonedElement = element.cloneNode(true);
  return clonedElement.childNodes.length === 0;
})(doc);

var ignoresCheckedAttribute = doc && (function (document) {
  var element = document.createElement('input');
  element.setAttribute('checked', 'checked');
  var clonedElement = element.cloneNode(false);
  return !clonedElement.checked;
})(doc);

var canRemoveSvgViewBoxAttribute = doc && (doc.createElementNS ? (function (document) {
  var element = document.createElementNS(_domHelperBuildHtmlDom.svgNamespace, 'svg');
  element.setAttribute('viewBox', '0 0 100 100');
  element.removeAttribute('viewBox');
  return !element.getAttribute('viewBox');
})(doc) : true);

var canClone = doc && (function (document) {
  var element = document.createElement('div');
  element.appendChild(document.createTextNode(' '));
  element.appendChild(document.createTextNode(' '));
  var clonedElement = element.cloneNode(true);
  return clonedElement.childNodes[0].nodeValue === ' ';
})(doc);

// This is not the namespace of the element, but of
// the elements inside that elements.
function interiorNamespace(element) {
  if (element && element.namespaceURI === _domHelperBuildHtmlDom.svgNamespace && !_domHelperBuildHtmlDom.svgHTMLIntegrationPoints[element.tagName]) {
    return _domHelperBuildHtmlDom.svgNamespace;
  } else {
    return null;
  }
}

// The HTML spec allows for "omitted start tags". These tags are optional
// when their intended child is the first thing in the parent tag. For
// example, this is a tbody start tag:
//
// <table>
//   <tbody>
//     <tr>
//
// The tbody may be omitted, and the browser will accept and render:
//
// <table>
//   <tr>
//
// However, the omitted start tag will still be added to the DOM. Here
// we test the string and context to see if the browser is about to
// perform this cleanup.
//
// http://www.whatwg.org/specs/web-apps/current-work/multipage/syntax.html#optional-tags
// describes which tags are omittable. The spec for tbody and colgroup
// explains this behavior:
//
// http://www.whatwg.org/specs/web-apps/current-work/multipage/tables.html#the-tbody-element
// http://www.whatwg.org/specs/web-apps/current-work/multipage/tables.html#the-colgroup-element
//

var omittedStartTagChildTest = /<([\w:]+)/;
function detectOmittedStartTag(string, contextualElement) {
  // Omitted start tags are only inside table tags.
  if (contextualElement.tagName === 'TABLE') {
    var omittedStartTagChildMatch = omittedStartTagChildTest.exec(string);
    if (omittedStartTagChildMatch) {
      var omittedStartTagChild = omittedStartTagChildMatch[1];
      // It is already asserted that the contextual element is a table
      // and not the proper start tag. Just see if a tag was omitted.
      return omittedStartTagChild === 'tr' || omittedStartTagChild === 'col';
    }
  }
}

function buildSVGDOM(html, dom) {
  var div = dom.document.createElement('div');
  div.innerHTML = '<svg>' + html + '</svg>';
  return div.firstChild.childNodes;
}

var guid = 1;

function ElementMorph(element, dom, namespace) {
  this.element = element;
  this.dom = dom;
  this.namespace = namespace;
  this.guid = "element" + guid++;

  this._state = undefined;
  this.isDirty = true;
}

ElementMorph.prototype.getState = function () {
  if (!this._state) {
    this._state = {};
  }

  return this._state;
};

ElementMorph.prototype.setState = function (newState) {
  /*jshint -W093 */

  return this._state = newState;
};

// renderAndCleanup calls `clear` on all items in the morph map
// just before calling `destroy` on the morph.
//
// As a future refactor this could be changed to set the property
// back to its original/default value.
ElementMorph.prototype.clear = function () {};

ElementMorph.prototype.destroy = function () {
  this.element = null;
  this.dom = null;
};

/*
 * A class wrapping DOM functions to address environment compatibility,
 * namespaces, contextual elements for morph un-escaped content
 * insertion.
 *
 * When entering a template, a DOMHelper should be passed:
 *
 *   template(context, { hooks: hooks, dom: new DOMHelper() });
 *
 * TODO: support foreignObject as a passed contextual element. It has
 * a namespace (svg) that does not match its internal namespace
 * (xhtml).
 *
 * @class DOMHelper
 * @constructor
 * @param {HTMLDocument} _document The document DOM methods are proxied to
 */
function DOMHelper(_document) {
  this.document = _document || document;
  if (!this.document) {
    throw new Error("A document object must be passed to the DOMHelper, or available on the global scope");
  }
  this.canClone = canClone;
  this.namespace = null;

  installEnvironmentSpecificMethods(this);
}

var prototype = DOMHelper.prototype;
prototype.constructor = DOMHelper;

prototype.getElementById = function (id, rootNode) {
  rootNode = rootNode || this.document;
  return rootNode.getElementById(id);
};

prototype.insertBefore = function (element, childElement, referenceChild) {
  return element.insertBefore(childElement, referenceChild);
};

prototype.appendChild = function (element, childElement) {
  return element.appendChild(childElement);
};

var itemAt;

// It appears that sometimes, in yet to be itentified scenarios PhantomJS 2.0
// crashes on childNodes.item(index), but works as expected with childNodes[index];
//
// Although it would be nice to move to childNodes[index] in all scenarios,
// this would require SimpleDOM to maintain the childNodes array. This would be
// quite costly, in both dev time and runtime.
//
// So instead, we choose the best possible method and call it a day.
//
/*global navigator */
if (typeof navigator !== 'undefined' && navigator.userAgent.indexOf('PhantomJS')) {
  itemAt = function (nodes, index) {
    return nodes[index];
  };
} else {
  itemAt = function (nodes, index) {
    return nodes.item(index);
  };
}

prototype.childAt = function (element, indices) {
  var child = element;

  for (var i = 0; i < indices.length; i++) {
    child = itemAt(child.childNodes, indices[i]);
  }

  return child;
};

// Note to a Fellow Implementor:
// Ahh, accessing a child node at an index. Seems like it should be so simple,
// doesn't it? Unfortunately, this particular method has caused us a surprising
// amount of pain. As you'll note below, this method has been modified to walk
// the linked list of child nodes rather than access the child by index
// directly, even though there are two (2) APIs in the DOM that do this for us.
// If you're thinking to yourself, "What an oversight! What an opportunity to
// optimize this code!" then to you I say: stop! For I have a tale to tell.
//
// First, this code must be compatible with simple-dom for rendering on the
// server where there is no real DOM. Previously, we accessed a child node
// directly via `element.childNodes[index]`. While we *could* in theory do a
// full-fidelity simulation of a live `childNodes` array, this is slow,
// complicated and error-prone.
//
// "No problem," we thought, "we'll just use the similar
// `childNodes.item(index)` API." Then, we could just implement our own `item`
// method in simple-dom and walk the child node linked list there, allowing
// us to retain the performance advantages of the (surely optimized) `item()`
// API in the browser.
//
// Unfortunately, an enterprising soul named Samy Alzahrani discovered that in
// IE8, accessing an item out-of-bounds via `item()` causes an exception where
// other browsers return null. This necessitated a... check of
// `childNodes.length`, bringing us back around to having to support a
// full-fidelity `childNodes` array!
//
// Worst of all, Kris Selden investigated how browsers are actualy implemented
// and discovered that they're all linked lists under the hood anyway. Accessing
// `childNodes` requires them to allocate a new live collection backed by that
// linked list, which is itself a rather expensive operation. Our assumed
// optimization had backfired! That is the danger of magical thinking about
// the performance of native implementations.
//
// And this, my friends, is why the following implementation just walks the
// linked list, as surprised as that may make you. Please ensure you understand
// the above before changing this and submitting a PR.
//
// Tom Dale, January 18th, 2015, Portland OR
prototype.childAtIndex = function (element, index) {
  var node = element.firstChild;

  for (var idx = 0; node && idx < index; idx++) {
    node = node.nextSibling;
  }

  return node;
};

prototype.appendText = function (element, text) {
  return element.appendChild(this.document.createTextNode(text));
};

prototype.setAttribute = function (element, name, value) {
  element.setAttribute(name, String(value));
};

prototype.getAttribute = function (element, name) {
  return element.getAttribute(name);
};

prototype.setAttributeNS = function (element, namespace, name, value) {
  element.setAttributeNS(namespace, name, String(value));
};

prototype.getAttributeNS = function (element, namespace, name) {
  return element.getAttributeNS(namespace, name);
};

if (canRemoveSvgViewBoxAttribute) {
  prototype.removeAttribute = function (element, name) {
    element.removeAttribute(name);
  };
} else {
  prototype.removeAttribute = function (element, name) {
    if (element.tagName === 'svg' && name === 'viewBox') {
      element.setAttribute(name, null);
    } else {
      element.removeAttribute(name);
    }
  };
}

prototype.setPropertyStrict = function (element, name, value) {
  if (value === undefined) {
    value = null;
  }

  if (value === null && (name === 'value' || name === 'type' || name === 'src')) {
    value = '';
  }

  element[name] = value;
};

prototype.getPropertyStrict = function (element, name) {
  return element[name];
};

prototype.setProperty = function (element, name, value, namespace) {
  if (element.namespaceURI === _domHelperBuildHtmlDom.svgNamespace) {
    if (_domHelperProp.isAttrRemovalValue(value)) {
      element.removeAttribute(name);
    } else {
      if (namespace) {
        element.setAttributeNS(namespace, name, value);
      } else {
        element.setAttribute(name, value);
      }
    }
  } else {
    var _normalizeProperty = _domHelperProp.normalizeProperty(element, name);

    var normalized = _normalizeProperty.normalized;
    var type = _normalizeProperty.type;

    if (type === 'prop') {
      element[normalized] = value;
    } else {
      if (_domHelperProp.isAttrRemovalValue(value)) {
        element.removeAttribute(name);
      } else {
        if (namespace && element.setAttributeNS) {
          element.setAttributeNS(namespace, name, value);
        } else {
          element.setAttribute(name, value);
        }
      }
    }
  }
};

if (doc && doc.createElementNS) {
  // Only opt into namespace detection if a contextualElement
  // is passed.
  prototype.createElement = function (tagName, contextualElement) {
    var namespace = this.namespace;
    if (contextualElement) {
      if (tagName === 'svg') {
        namespace = _domHelperBuildHtmlDom.svgNamespace;
      } else {
        namespace = interiorNamespace(contextualElement);
      }
    }
    if (namespace) {
      return this.document.createElementNS(namespace, tagName);
    } else {
      return this.document.createElement(tagName);
    }
  };
  prototype.setAttributeNS = function (element, namespace, name, value) {
    element.setAttributeNS(namespace, name, String(value));
  };
} else {
  prototype.createElement = function (tagName) {
    return this.document.createElement(tagName);
  };
  prototype.setAttributeNS = function (element, namespace, name, value) {
    element.setAttribute(name, String(value));
  };
}

prototype.addClasses = _domHelperClasses.addClasses;
prototype.removeClasses = _domHelperClasses.removeClasses;

prototype.setNamespace = function (ns) {
  this.namespace = ns;
};

prototype.detectNamespace = function (element) {
  this.namespace = interiorNamespace(element);
};

prototype.createDocumentFragment = function () {
  return this.document.createDocumentFragment();
};

prototype.createTextNode = function (text) {
  return this.document.createTextNode(text);
};

prototype.createComment = function (text) {
  return this.document.createComment(text);
};

prototype.repairClonedNode = function (element, blankChildTextNodes, isChecked) {
  if (deletesBlankTextNodes && blankChildTextNodes.length > 0) {
    for (var i = 0, len = blankChildTextNodes.length; i < len; i++) {
      var textNode = this.document.createTextNode(''),
          offset = blankChildTextNodes[i],
          before = this.childAtIndex(element, offset);
      if (before) {
        element.insertBefore(textNode, before);
      } else {
        element.appendChild(textNode);
      }
    }
  }
  if (ignoresCheckedAttribute && isChecked) {
    element.setAttribute('checked', 'checked');
  }
};

prototype.cloneNode = function (element, deep) {
  var clone = element.cloneNode(!!deep);
  return clone;
};

prototype.AttrMorphClass = _morphAttr2.default;

prototype.createAttrMorph = function (element, attrName, namespace) {
  return this.AttrMorphClass.create(element, attrName, this, namespace);
};

prototype.ElementMorphClass = ElementMorph;

prototype.createElementMorph = function (element, namespace) {
  return new this.ElementMorphClass(element, this, namespace);
};

prototype.createUnsafeAttrMorph = function (element, attrName, namespace) {
  var morph = this.createAttrMorph(element, attrName, namespace);
  morph.escaped = false;
  return morph;
};

prototype.MorphClass = _htmlbarsRuntimeMorph2.default;

prototype.createMorph = function (parent, start, end, contextualElement) {
  if (contextualElement && contextualElement.nodeType === 11) {
    throw new Error("Cannot pass a fragment as the contextual element to createMorph");
  }

  if (!contextualElement && parent && parent.nodeType === 1) {
    contextualElement = parent;
  }
  var morph = new this.MorphClass(this, contextualElement);
  morph.firstNode = start;
  morph.lastNode = end;
  return morph;
};

prototype.createFragmentMorph = function (contextualElement) {
  if (contextualElement && contextualElement.nodeType === 11) {
    throw new Error("Cannot pass a fragment as the contextual element to createMorph");
  }

  var fragment = this.createDocumentFragment();
  return _htmlbarsRuntimeMorph2.default.create(this, contextualElement, fragment);
};

prototype.replaceContentWithMorph = function (element) {
  var firstChild = element.firstChild;

  if (!firstChild) {
    var comment = this.createComment('');
    this.appendChild(element, comment);
    return _htmlbarsRuntimeMorph2.default.create(this, element, comment);
  } else {
    var morph = _htmlbarsRuntimeMorph2.default.attach(this, element, firstChild, element.lastChild);
    morph.clear();
    return morph;
  }
};

prototype.createUnsafeMorph = function (parent, start, end, contextualElement) {
  var morph = this.createMorph(parent, start, end, contextualElement);
  morph.parseTextAsHTML = true;
  return morph;
};

// This helper is just to keep the templates good looking,
// passing integers instead of element references.
prototype.createMorphAt = function (parent, startIndex, endIndex, contextualElement) {
  var single = startIndex === endIndex;
  var start = this.childAtIndex(parent, startIndex);
  var end = single ? start : this.childAtIndex(parent, endIndex);
  return this.createMorph(parent, start, end, contextualElement);
};

prototype.createUnsafeMorphAt = function (parent, startIndex, endIndex, contextualElement) {
  var morph = this.createMorphAt(parent, startIndex, endIndex, contextualElement);
  morph.parseTextAsHTML = true;
  return morph;
};

prototype.insertMorphBefore = function (element, referenceChild, contextualElement) {
  var insertion = this.document.createComment('');
  element.insertBefore(insertion, referenceChild);
  return this.createMorph(element, insertion, insertion, contextualElement);
};

prototype.appendMorph = function (element, contextualElement) {
  var insertion = this.document.createComment('');
  element.appendChild(insertion);
  return this.createMorph(element, insertion, insertion, contextualElement);
};

prototype.insertBoundary = function (fragment, index) {
  // this will always be null or firstChild
  var child = index === null ? null : this.childAtIndex(fragment, index);
  this.insertBefore(fragment, this.createTextNode(''), child);
};

prototype.setMorphHTML = function (morph, html) {
  morph.setHTML(html);
};

prototype.parseHTML = function (html, contextualElement) {
  var childNodes;

  if (interiorNamespace(contextualElement) === _domHelperBuildHtmlDom.svgNamespace) {
    childNodes = buildSVGDOM(html, this);
  } else {
    var nodes = _domHelperBuildHtmlDom.buildHTMLDOM(html, contextualElement, this);
    if (detectOmittedStartTag(html, contextualElement)) {
      var node = nodes[0];
      while (node && node.nodeType !== 1) {
        node = node.nextSibling;
      }
      childNodes = node.childNodes;
    } else {
      childNodes = nodes;
    }
  }

  // Copy node list to a fragment.
  var fragment = this.document.createDocumentFragment();

  if (childNodes && childNodes.length > 0) {
    var currentNode = childNodes[0];

    // We prepend an <option> to <select> boxes to absorb any browser bugs
    // related to auto-select behavior. Skip past it.
    if (contextualElement.tagName === 'SELECT') {
      currentNode = currentNode.nextSibling;
    }

    while (currentNode) {
      var tempNode = currentNode;
      currentNode = currentNode.nextSibling;

      fragment.appendChild(tempNode);
    }
  }

  return fragment;
};

var nodeURL;
var parsingNode;

function installEnvironmentSpecificMethods(domHelper) {
  var protocol = browserProtocolForURL.call(domHelper, 'foobar:baz');

  // Test to see if our DOM implementation parses
  // and normalizes URLs.
  if (protocol === 'foobar:') {
    // Swap in the method that doesn't do this test now that
    // we know it works.
    domHelper.protocolForURL = browserProtocolForURL;
  } else if (typeof URL === 'object') {
    // URL globally provided, likely from FastBoot's sandbox
    nodeURL = URL;
    domHelper.protocolForURL = nodeProtocolForURL;
  } else if (typeof module === 'object' && typeof module.require === 'function') {
    // Otherwise, we need to fall back to our own URL parsing.
    // Global `require` is shadowed by Ember's loader so we have to use the fully
    // qualified `module.require`.
    nodeURL = module.require('url');
    domHelper.protocolForURL = nodeProtocolForURL;
  } else {
    throw new Error("DOM Helper could not find valid URL parsing mechanism");
  }

  // A SimpleDOM-specific extension that allows us to place HTML directly
  // into the DOM tree, for when the output target is always serialized HTML.
  if (domHelper.document.createRawHTMLSection) {
    domHelper.setMorphHTML = nodeSetMorphHTML;
  }
}

function nodeSetMorphHTML(morph, html) {
  var section = this.document.createRawHTMLSection(html);
  morph.setNode(section);
}

function browserProtocolForURL(url) {
  if (!parsingNode) {
    parsingNode = this.document.createElement('a');
  }

  parsingNode.href = url;
  return parsingNode.protocol;
}

function nodeProtocolForURL(url) {
  var protocol = nodeURL.parse(url).protocol;
  return protocol === null ? ':' : protocol;
}

exports.default = DOMHelper;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;base64,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QVcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQztHQUNoRDs7QUFFRCxhQUFXLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQztBQUN2QixTQUFPLFdBQVcsQ0FBQyxRQUFRLENBQUM7Q0FDN0I7O0FBRUQsU0FBUyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUU7QUFDL0IsTUFBSSxRQUFRLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUM7QUFDM0MsU0FBTyxBQUFDLFFBQVEsS0FBSyxJQUFJLEdBQUksR0FBRyxHQUFHLFFBQVEsQ0FBQztDQUM3Qzs7a0JBRWMsU0FBUyIsImZpbGUiOiJkb20taGVscGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypnbG9iYWxzIG1vZHVsZSwgVVJMKi9cblxuaW1wb3J0IE1vcnBoIGZyb20gXCIuL2h0bWxiYXJzLXJ1bnRpbWUvbW9ycGhcIjtcbmltcG9ydCBBdHRyTW9ycGggZnJvbSBcIi4vbW9ycGgtYXR0clwiO1xuaW1wb3J0IHtcbiAgYnVpbGRIVE1MRE9NLFxuICBzdmdOYW1lc3BhY2UsXG4gIHN2Z0hUTUxJbnRlZ3JhdGlvblBvaW50c1xufSBmcm9tIFwiLi9kb20taGVscGVyL2J1aWxkLWh0bWwtZG9tXCI7XG5pbXBvcnQge1xuICBhZGRDbGFzc2VzLFxuICByZW1vdmVDbGFzc2VzXG59IGZyb20gXCIuL2RvbS1oZWxwZXIvY2xhc3Nlc1wiO1xuaW1wb3J0IHtcbiAgbm9ybWFsaXplUHJvcGVydHlcbn0gZnJvbSBcIi4vZG9tLWhlbHBlci9wcm9wXCI7XG5pbXBvcnQgeyBpc0F0dHJSZW1vdmFsVmFsdWUgfSBmcm9tIFwiLi9kb20taGVscGVyL3Byb3BcIjtcblxudmFyIGRvYyA9IHR5cGVvZiBkb2N1bWVudCA9PT0gJ3VuZGVmaW5lZCcgPyBmYWxzZSA6IGRvY3VtZW50O1xuXG52YXIgZGVsZXRlc0JsYW5rVGV4dE5vZGVzID0gZG9jICYmIChmdW5jdGlvbihkb2N1bWVudCl7XG4gIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIGVsZW1lbnQuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnKSApO1xuICB2YXIgY2xvbmVkRWxlbWVudCA9IGVsZW1lbnQuY2xvbmVOb2RlKHRydWUpO1xuICByZXR1cm4gY2xvbmVkRWxlbWVudC5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gMDtcbn0pKGRvYyk7XG5cbnZhciBpZ25vcmVzQ2hlY2tlZEF0dHJpYnV0ZSA9IGRvYyAmJiAoZnVuY3Rpb24oZG9jdW1lbnQpe1xuICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdjaGVja2VkJywgJ2NoZWNrZWQnKTtcbiAgdmFyIGNsb25lZEVsZW1lbnQgPSBlbGVtZW50LmNsb25lTm9kZShmYWxzZSk7XG4gIHJldHVybiAhY2xvbmVkRWxlbWVudC5jaGVja2VkO1xufSkoZG9jKTtcblxudmFyIGNhblJlbW92ZVN2Z1ZpZXdCb3hBdHRyaWJ1dGUgPSBkb2MgJiYgKGRvYy5jcmVhdGVFbGVtZW50TlMgPyAoZnVuY3Rpb24oZG9jdW1lbnQpe1xuICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOYW1lc3BhY2UsICdzdmcnKTtcbiAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3ZpZXdCb3gnLCAnMCAwIDEwMCAxMDAnKTtcbiAgZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ3ZpZXdCb3gnKTtcbiAgcmV0dXJuICFlbGVtZW50LmdldEF0dHJpYnV0ZSgndmlld0JveCcpO1xufSkoZG9jKSA6IHRydWUpO1xuXG52YXIgY2FuQ2xvbmUgPSBkb2MgJiYgKGZ1bmN0aW9uKGRvY3VtZW50KXtcbiAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgZWxlbWVudC5hcHBlbmRDaGlsZCggZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJyAnKSk7XG4gIGVsZW1lbnQuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcgJykpO1xuICB2YXIgY2xvbmVkRWxlbWVudCA9IGVsZW1lbnQuY2xvbmVOb2RlKHRydWUpO1xuICByZXR1cm4gY2xvbmVkRWxlbWVudC5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gJyAnO1xufSkoZG9jKTtcblxuLy8gVGhpcyBpcyBub3QgdGhlIG5hbWVzcGFjZSBvZiB0aGUgZWxlbWVudCwgYnV0IG9mXG4vLyB0aGUgZWxlbWVudHMgaW5zaWRlIHRoYXQgZWxlbWVudHMuXG5mdW5jdGlvbiBpbnRlcmlvck5hbWVzcGFjZShlbGVtZW50KXtcbiAgaWYgKFxuICAgIGVsZW1lbnQgJiZcbiAgICBlbGVtZW50Lm5hbWVzcGFjZVVSSSA9PT0gc3ZnTmFtZXNwYWNlICYmXG4gICAgIXN2Z0hUTUxJbnRlZ3JhdGlvblBvaW50c1tlbGVtZW50LnRhZ05hbWVdXG4gICkge1xuICAgIHJldHVybiBzdmdOYW1lc3BhY2U7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLy8gVGhlIEhUTUwgc3BlYyBhbGxvd3MgZm9yIFwib21pdHRlZCBzdGFydCB0YWdzXCIuIFRoZXNlIHRhZ3MgYXJlIG9wdGlvbmFsXG4vLyB3aGVuIHRoZWlyIGludGVuZGVkIGNoaWxkIGlzIHRoZSBmaXJzdCB0aGluZyBpbiB0aGUgcGFyZW50IHRhZy4gRm9yXG4vLyBleGFtcGxlLCB0aGlzIGlzIGEgdGJvZHkgc3RhcnQgdGFnOlxuLy9cbi8vIDx0YWJsZT5cbi8vICAgPHRib2R5PlxuLy8gICAgIDx0cj5cbi8vXG4vLyBUaGUgdGJvZHkgbWF5IGJlIG9taXR0ZWQsIGFuZCB0aGUgYnJvd3NlciB3aWxsIGFjY2VwdCBhbmQgcmVuZGVyOlxuLy9cbi8vIDx0YWJsZT5cbi8vICAgPHRyPlxuLy9cbi8vIEhvd2V2ZXIsIHRoZSBvbWl0dGVkIHN0YXJ0IHRhZyB3aWxsIHN0aWxsIGJlIGFkZGVkIHRvIHRoZSBET00uIEhlcmVcbi8vIHdlIHRlc3QgdGhlIHN0cmluZyBhbmQgY29udGV4dCB0byBzZWUgaWYgdGhlIGJyb3dzZXIgaXMgYWJvdXQgdG9cbi8vIHBlcmZvcm0gdGhpcyBjbGVhbnVwLlxuLy9cbi8vIGh0dHA6Ly93d3cud2hhdHdnLm9yZy9zcGVjcy93ZWItYXBwcy9jdXJyZW50LXdvcmsvbXVsdGlwYWdlL3N5bnRheC5odG1sI29wdGlvbmFsLXRhZ3Ncbi8vIGRlc2NyaWJlcyB3aGljaCB0YWdzIGFyZSBvbWl0dGFibGUuIFRoZSBzcGVjIGZvciB0Ym9keSBhbmQgY29sZ3JvdXBcbi8vIGV4cGxhaW5zIHRoaXMgYmVoYXZpb3I6XG4vL1xuLy8gaHR0cDovL3d3dy53aGF0d2cub3JnL3NwZWNzL3dlYi1hcHBzL2N1cnJlbnQtd29yay9tdWx0aXBhZ2UvdGFibGVzLmh0bWwjdGhlLXRib2R5LWVsZW1lbnRcbi8vIGh0dHA6Ly93d3cud2hhdHdnLm9yZy9zcGVjcy93ZWItYXBwcy9jdXJyZW50LXdvcmsvbXVsdGlwYWdlL3RhYmxlcy5odG1sI3RoZS1jb2xncm91cC1lbGVtZW50XG4vL1xuXG52YXIgb21pdHRlZFN0YXJ0VGFnQ2hpbGRUZXN0ID0gLzwoW1xcdzpdKykvO1xuZnVuY3Rpb24gZGV0ZWN0T21pdHRlZFN0YXJ0VGFnKHN0cmluZywgY29udGV4dHVhbEVsZW1lbnQpe1xuICAvLyBPbWl0dGVkIHN0YXJ0IHRhZ3MgYXJlIG9ubHkgaW5zaWRlIHRhYmxlIHRhZ3MuXG4gIGlmIChjb250ZXh0dWFsRWxlbWVudC50YWdOYW1lID09PSAnVEFCTEUnKSB7XG4gICAgdmFyIG9taXR0ZWRTdGFydFRhZ0NoaWxkTWF0Y2ggPSBvbWl0dGVkU3RhcnRUYWdDaGlsZFRlc3QuZXhlYyhzdHJpbmcpO1xuICAgIGlmIChvbWl0dGVkU3RhcnRUYWdDaGlsZE1hdGNoKSB7XG4gICAgICB2YXIgb21pdHRlZFN0YXJ0VGFnQ2hpbGQgPSBvbWl0dGVkU3RhcnRUYWdDaGlsZE1hdGNoWzFdO1xuICAgICAgLy8gSXQgaXMgYWxyZWFkeSBhc3NlcnRlZCB0aGF0IHRoZSBjb250ZXh0dWFsIGVsZW1lbnQgaXMgYSB0YWJsZVxuICAgICAgLy8gYW5kIG5vdCB0aGUgcHJvcGVyIHN0YXJ0IHRhZy4gSnVzdCBzZWUgaWYgYSB0YWcgd2FzIG9taXR0ZWQuXG4gICAgICByZXR1cm4gb21pdHRlZFN0YXJ0VGFnQ2hpbGQgPT09ICd0cicgfHxcbiAgICAgICAgICAgICBvbWl0dGVkU3RhcnRUYWdDaGlsZCA9PT0gJ2NvbCc7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGJ1aWxkU1ZHRE9NKGh0bWwsIGRvbSl7XG4gIHZhciBkaXYgPSBkb20uZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIGRpdi5pbm5lckhUTUwgPSAnPHN2Zz4nK2h0bWwrJzwvc3ZnPic7XG4gIHJldHVybiBkaXYuZmlyc3RDaGlsZC5jaGlsZE5vZGVzO1xufVxuXG52YXIgZ3VpZCA9IDE7XG5cbmZ1bmN0aW9uIEVsZW1lbnRNb3JwaChlbGVtZW50LCBkb20sIG5hbWVzcGFjZSkge1xuICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuICB0aGlzLmRvbSA9IGRvbTtcbiAgdGhpcy5uYW1lc3BhY2UgPSBuYW1lc3BhY2U7XG4gIHRoaXMuZ3VpZCA9IFwiZWxlbWVudFwiICsgZ3VpZCsrO1xuXG4gIHRoaXMuX3N0YXRlID0gdW5kZWZpbmVkO1xuICB0aGlzLmlzRGlydHkgPSB0cnVlO1xufVxuXG5FbGVtZW50TW9ycGgucHJvdG90eXBlLmdldFN0YXRlID0gZnVuY3Rpb24oKSB7XG4gIGlmICghdGhpcy5fc3RhdGUpIHtcbiAgICB0aGlzLl9zdGF0ZSA9IHt9O1xuICB9XG5cbiAgcmV0dXJuIHRoaXMuX3N0YXRlO1xufTtcblxuRWxlbWVudE1vcnBoLnByb3RvdHlwZS5zZXRTdGF0ZSA9IGZ1bmN0aW9uKG5ld1N0YXRlKSB7XG4gIC8qanNoaW50IC1XMDkzICovXG5cbiAgcmV0dXJuIHRoaXMuX3N0YXRlID0gbmV3U3RhdGU7XG59O1xuXG4vLyByZW5kZXJBbmRDbGVhbnVwIGNhbGxzIGBjbGVhcmAgb24gYWxsIGl0ZW1zIGluIHRoZSBtb3JwaCBtYXBcbi8vIGp1c3QgYmVmb3JlIGNhbGxpbmcgYGRlc3Ryb3lgIG9uIHRoZSBtb3JwaC5cbi8vXG4vLyBBcyBhIGZ1dHVyZSByZWZhY3RvciB0aGlzIGNvdWxkIGJlIGNoYW5nZWQgdG8gc2V0IHRoZSBwcm9wZXJ0eVxuLy8gYmFjayB0byBpdHMgb3JpZ2luYWwvZGVmYXVsdCB2YWx1ZS5cbkVsZW1lbnRNb3JwaC5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbigpIHsgfTtcblxuRWxlbWVudE1vcnBoLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuZWxlbWVudCA9IG51bGw7XG4gIHRoaXMuZG9tID0gbnVsbDtcbn07XG5cblxuLypcbiAqIEEgY2xhc3Mgd3JhcHBpbmcgRE9NIGZ1bmN0aW9ucyB0byBhZGRyZXNzIGVudmlyb25tZW50IGNvbXBhdGliaWxpdHksXG4gKiBuYW1lc3BhY2VzLCBjb250ZXh0dWFsIGVsZW1lbnRzIGZvciBtb3JwaCB1bi1lc2NhcGVkIGNvbnRlbnRcbiAqIGluc2VydGlvbi5cbiAqXG4gKiBXaGVuIGVudGVyaW5nIGEgdGVtcGxhdGUsIGEgRE9NSGVscGVyIHNob3VsZCBiZSBwYXNzZWQ6XG4gKlxuICogICB0ZW1wbGF0ZShjb250ZXh0LCB7IGhvb2tzOiBob29rcywgZG9tOiBuZXcgRE9NSGVscGVyKCkgfSk7XG4gKlxuICogVE9ETzogc3VwcG9ydCBmb3JlaWduT2JqZWN0IGFzIGEgcGFzc2VkIGNvbnRleHR1YWwgZWxlbWVudC4gSXQgaGFzXG4gKiBhIG5hbWVzcGFjZSAoc3ZnKSB0aGF0IGRvZXMgbm90IG1hdGNoIGl0cyBpbnRlcm5hbCBuYW1lc3BhY2VcbiAqICh4aHRtbCkuXG4gKlxuICogQGNsYXNzIERPTUhlbHBlclxuICogQGNvbnN0cnVjdG9yXG4gKiBAcGFyYW0ge0hUTUxEb2N1bWVudH0gX2RvY3VtZW50IFRoZSBkb2N1bWVudCBET00gbWV0aG9kcyBhcmUgcHJveGllZCB0b1xuICovXG5mdW5jdGlvbiBET01IZWxwZXIoX2RvY3VtZW50KXtcbiAgdGhpcy5kb2N1bWVudCA9IF9kb2N1bWVudCB8fCBkb2N1bWVudDtcbiAgaWYgKCF0aGlzLmRvY3VtZW50KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQSBkb2N1bWVudCBvYmplY3QgbXVzdCBiZSBwYXNzZWQgdG8gdGhlIERPTUhlbHBlciwgb3IgYXZhaWxhYmxlIG9uIHRoZSBnbG9iYWwgc2NvcGVcIik7XG4gIH1cbiAgdGhpcy5jYW5DbG9uZSA9IGNhbkNsb25lO1xuICB0aGlzLm5hbWVzcGFjZSA9IG51bGw7XG5cbiAgaW5zdGFsbEVudmlyb25tZW50U3BlY2lmaWNNZXRob2RzKHRoaXMpO1xufVxuXG52YXIgcHJvdG90eXBlID0gRE9NSGVscGVyLnByb3RvdHlwZTtcbnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IERPTUhlbHBlcjtcblxucHJvdG90eXBlLmdldEVsZW1lbnRCeUlkID0gZnVuY3Rpb24oaWQsIHJvb3ROb2RlKSB7XG4gIHJvb3ROb2RlID0gcm9vdE5vZGUgfHwgdGhpcy5kb2N1bWVudDtcbiAgcmV0dXJuIHJvb3ROb2RlLmdldEVsZW1lbnRCeUlkKGlkKTtcbn07XG5cbnByb3RvdHlwZS5pbnNlcnRCZWZvcmUgPSBmdW5jdGlvbihlbGVtZW50LCBjaGlsZEVsZW1lbnQsIHJlZmVyZW5jZUNoaWxkKSB7XG4gIHJldHVybiBlbGVtZW50Lmluc2VydEJlZm9yZShjaGlsZEVsZW1lbnQsIHJlZmVyZW5jZUNoaWxkKTtcbn07XG5cbnByb3RvdHlwZS5hcHBlbmRDaGlsZCA9IGZ1bmN0aW9uKGVsZW1lbnQsIGNoaWxkRWxlbWVudCkge1xuICByZXR1cm4gZWxlbWVudC5hcHBlbmRDaGlsZChjaGlsZEVsZW1lbnQpO1xufTtcblxudmFyIGl0ZW1BdDtcblxuLy8gSXQgYXBwZWFycyB0aGF0IHNvbWV0aW1lcywgaW4geWV0IHRvIGJlIGl0ZW50aWZpZWQgc2NlbmFyaW9zIFBoYW50b21KUyAyLjBcbi8vIGNyYXNoZXMgb24gY2hpbGROb2Rlcy5pdGVtKGluZGV4KSwgYnV0IHdvcmtzIGFzIGV4cGVjdGVkIHdpdGggY2hpbGROb2Rlc1tpbmRleF07XG4vL1xuLy8gQWx0aG91Z2ggaXQgd291bGQgYmUgbmljZSB0byBtb3ZlIHRvIGNoaWxkTm9kZXNbaW5kZXhdIGluIGFsbCBzY2VuYXJpb3MsXG4vLyB0aGlzIHdvdWxkIHJlcXVpcmUgU2ltcGxlRE9NIHRvIG1haW50YWluIHRoZSBjaGlsZE5vZGVzIGFycmF5LiBUaGlzIHdvdWxkIGJlXG4vLyBxdWl0ZSBjb3N0bHksIGluIGJvdGggZGV2IHRpbWUgYW5kIHJ1bnRpbWUuXG4vL1xuLy8gU28gaW5zdGVhZCwgd2UgY2hvb3NlIHRoZSBiZXN0IHBvc3NpYmxlIG1ldGhvZCBhbmQgY2FsbCBpdCBhIGRheS5cbi8vXG4vKmdsb2JhbCBuYXZpZ2F0b3IgKi9cbmlmICh0eXBlb2YgbmF2aWdhdG9yICE9PSAndW5kZWZpbmVkJyAmJlxuICAgIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignUGhhbnRvbUpTJykpIHtcbiAgaXRlbUF0ID0gZnVuY3Rpb24obm9kZXMsIGluZGV4KSB7XG4gICAgcmV0dXJuIG5vZGVzW2luZGV4XTtcbiAgfTtcbn0gZWxzZSB7XG4gIGl0ZW1BdCA9IGZ1bmN0aW9uKG5vZGVzLCBpbmRleCkge1xuICAgIHJldHVybiBub2Rlcy5pdGVtKGluZGV4KTtcbiAgfTtcbn1cblxucHJvdG90eXBlLmNoaWxkQXQgPSBmdW5jdGlvbihlbGVtZW50LCBpbmRpY2VzKSB7XG4gIHZhciBjaGlsZCA9IGVsZW1lbnQ7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbmRpY2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgY2hpbGQgPSBpdGVtQXQoY2hpbGQuY2hpbGROb2RlcywgaW5kaWNlc1tpXSk7XG4gIH1cblxuICByZXR1cm4gY2hpbGQ7XG59O1xuXG4vLyBOb3RlIHRvIGEgRmVsbG93IEltcGxlbWVudG9yOlxuLy8gQWhoLCBhY2Nlc3NpbmcgYSBjaGlsZCBub2RlIGF0IGFuIGluZGV4LiBTZWVtcyBsaWtlIGl0IHNob3VsZCBiZSBzbyBzaW1wbGUsXG4vLyBkb2Vzbid0IGl0PyBVbmZvcnR1bmF0ZWx5LCB0aGlzIHBhcnRpY3VsYXIgbWV0aG9kIGhhcyBjYXVzZWQgdXMgYSBzdXJwcmlzaW5nXG4vLyBhbW91bnQgb2YgcGFpbi4gQXMgeW91J2xsIG5vdGUgYmVsb3csIHRoaXMgbWV0aG9kIGhhcyBiZWVuIG1vZGlmaWVkIHRvIHdhbGtcbi8vIHRoZSBsaW5rZWQgbGlzdCBvZiBjaGlsZCBub2RlcyByYXRoZXIgdGhhbiBhY2Nlc3MgdGhlIGNoaWxkIGJ5IGluZGV4XG4vLyBkaXJlY3RseSwgZXZlbiB0aG91Z2ggdGhlcmUgYXJlIHR3byAoMikgQVBJcyBpbiB0aGUgRE9NIHRoYXQgZG8gdGhpcyBmb3IgdXMuXG4vLyBJZiB5b3UncmUgdGhpbmtpbmcgdG8geW91cnNlbGYsIFwiV2hhdCBhbiBvdmVyc2lnaHQhIFdoYXQgYW4gb3Bwb3J0dW5pdHkgdG9cbi8vIG9wdGltaXplIHRoaXMgY29kZSFcIiB0aGVuIHRvIHlvdSBJIHNheTogc3RvcCEgRm9yIEkgaGF2ZSBhIHRhbGUgdG8gdGVsbC5cbi8vXG4vLyBGaXJzdCwgdGhpcyBjb2RlIG11c3QgYmUgY29tcGF0aWJsZSB3aXRoIHNpbXBsZS1kb20gZm9yIHJlbmRlcmluZyBvbiB0aGVcbi8vIHNlcnZlciB3aGVyZSB0aGVyZSBpcyBubyByZWFsIERPTS4gUHJldmlvdXNseSwgd2UgYWNjZXNzZWQgYSBjaGlsZCBub2RlXG4vLyBkaXJlY3RseSB2aWEgYGVsZW1lbnQuY2hpbGROb2Rlc1tpbmRleF1gLiBXaGlsZSB3ZSAqY291bGQqIGluIHRoZW9yeSBkbyBhXG4vLyBmdWxsLWZpZGVsaXR5IHNpbXVsYXRpb24gb2YgYSBsaXZlIGBjaGlsZE5vZGVzYCBhcnJheSwgdGhpcyBpcyBzbG93LFxuLy8gY29tcGxpY2F0ZWQgYW5kIGVycm9yLXByb25lLlxuLy9cbi8vIFwiTm8gcHJvYmxlbSxcIiB3ZSB0aG91Z2h0LCBcIndlJ2xsIGp1c3QgdXNlIHRoZSBzaW1pbGFyXG4vLyBgY2hpbGROb2Rlcy5pdGVtKGluZGV4KWAgQVBJLlwiIFRoZW4sIHdlIGNvdWxkIGp1c3QgaW1wbGVtZW50IG91ciBvd24gYGl0ZW1gXG4vLyBtZXRob2QgaW4gc2ltcGxlLWRvbSBhbmQgd2FsayB0aGUgY2hpbGQgbm9kZSBsaW5rZWQgbGlzdCB0aGVyZSwgYWxsb3dpbmdcbi8vIHVzIHRvIHJldGFpbiB0aGUgcGVyZm9ybWFuY2UgYWR2YW50YWdlcyBvZiB0aGUgKHN1cmVseSBvcHRpbWl6ZWQpIGBpdGVtKClgXG4vLyBBUEkgaW4gdGhlIGJyb3dzZXIuXG4vL1xuLy8gVW5mb3J0dW5hdGVseSwgYW4gZW50ZXJwcmlzaW5nIHNvdWwgbmFtZWQgU2FteSBBbHphaHJhbmkgZGlzY292ZXJlZCB0aGF0IGluXG4vLyBJRTgsIGFjY2Vzc2luZyBhbiBpdGVtIG91dC1vZi1ib3VuZHMgdmlhIGBpdGVtKClgIGNhdXNlcyBhbiBleGNlcHRpb24gd2hlcmVcbi8vIG90aGVyIGJyb3dzZXJzIHJldHVybiBudWxsLiBUaGlzIG5lY2Vzc2l0YXRlZCBhLi4uIGNoZWNrIG9mXG4vLyBgY2hpbGROb2Rlcy5sZW5ndGhgLCBicmluZ2luZyB1cyBiYWNrIGFyb3VuZCB0byBoYXZpbmcgdG8gc3VwcG9ydCBhXG4vLyBmdWxsLWZpZGVsaXR5IGBjaGlsZE5vZGVzYCBhcnJheSFcbi8vXG4vLyBXb3JzdCBvZiBhbGwsIEtyaXMgU2VsZGVuIGludmVzdGlnYXRlZCBob3cgYnJvd3NlcnMgYXJlIGFjdHVhbHkgaW1wbGVtZW50ZWRcbi8vIGFuZCBkaXNjb3ZlcmVkIHRoYXQgdGhleSdyZSBhbGwgbGlua2VkIGxpc3RzIHVuZGVyIHRoZSBob29kIGFueXdheS4gQWNjZXNzaW5nXG4vLyBgY2hpbGROb2Rlc2AgcmVxdWlyZXMgdGhlbSB0byBhbGxvY2F0ZSBhIG5ldyBsaXZlIGNvbGxlY3Rpb24gYmFja2VkIGJ5IHRoYXRcbi8vIGxpbmtlZCBsaXN0LCB3aGljaCBpcyBpdHNlbGYgYSByYXRoZXIgZXhwZW5zaXZlIG9wZXJhdGlvbi4gT3VyIGFzc3VtZWRcbi8vIG9wdGltaXphdGlvbiBoYWQgYmFja2ZpcmVkISBUaGF0IGlzIHRoZSBkYW5nZXIgb2YgbWFnaWNhbCB0aGlua2luZyBhYm91dFxuLy8gdGhlIHBlcmZvcm1hbmNlIG9mIG5hdGl2ZSBpbXBsZW1lbnRhdGlvbnMuXG4vL1xuLy8gQW5kIHRoaXMsIG15IGZyaWVuZHMsIGlzIHdoeSB0aGUgZm9sbG93aW5nIGltcGxlbWVudGF0aW9uIGp1c3Qgd2Fsa3MgdGhlXG4vLyBsaW5rZWQgbGlzdCwgYXMgc3VycHJpc2VkIGFzIHRoYXQgbWF5IG1ha2UgeW91LiBQbGVhc2UgZW5zdXJlIHlvdSB1bmRlcnN0YW5kXG4vLyB0aGUgYWJvdmUgYmVmb3JlIGNoYW5naW5nIHRoaXMgYW5kIHN1Ym1pdHRpbmcgYSBQUi5cbi8vXG4vLyBUb20gRGFsZSwgSmFudWFyeSAxOHRoLCAyMDE1LCBQb3J0bGFuZCBPUlxucHJvdG90eXBlLmNoaWxkQXRJbmRleCA9IGZ1bmN0aW9uKGVsZW1lbnQsIGluZGV4KSB7XG4gIHZhciBub2RlID0gZWxlbWVudC5maXJzdENoaWxkO1xuXG4gIGZvciAodmFyIGlkeCA9IDA7IG5vZGUgJiYgaWR4IDwgaW5kZXg7IGlkeCsrKSB7XG4gICAgbm9kZSA9IG5vZGUubmV4dFNpYmxpbmc7XG4gIH1cblxuICByZXR1cm4gbm9kZTtcbn07XG5cbnByb3RvdHlwZS5hcHBlbmRUZXh0ID0gZnVuY3Rpb24oZWxlbWVudCwgdGV4dCkge1xuICByZXR1cm4gZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRleHQpKTtcbn07XG5cbnByb3RvdHlwZS5zZXRBdHRyaWJ1dGUgPSBmdW5jdGlvbihlbGVtZW50LCBuYW1lLCB2YWx1ZSkge1xuICBlbGVtZW50LnNldEF0dHJpYnV0ZShuYW1lLCBTdHJpbmcodmFsdWUpKTtcbn07XG5cbnByb3RvdHlwZS5nZXRBdHRyaWJ1dGUgPSBmdW5jdGlvbihlbGVtZW50LCBuYW1lKSB7XG4gIHJldHVybiBlbGVtZW50LmdldEF0dHJpYnV0ZShuYW1lKTtcbn07XG5cbnByb3RvdHlwZS5zZXRBdHRyaWJ1dGVOUyA9IGZ1bmN0aW9uKGVsZW1lbnQsIG5hbWVzcGFjZSwgbmFtZSwgdmFsdWUpIHtcbiAgZWxlbWVudC5zZXRBdHRyaWJ1dGVOUyhuYW1lc3BhY2UsIG5hbWUsIFN0cmluZyh2YWx1ZSkpO1xufTtcblxucHJvdG90eXBlLmdldEF0dHJpYnV0ZU5TID0gZnVuY3Rpb24oZWxlbWVudCwgbmFtZXNwYWNlLCBuYW1lKSB7XG4gIHJldHVybiBlbGVtZW50LmdldEF0dHJpYnV0ZU5TKG5hbWVzcGFjZSwgbmFtZSk7XG59O1xuXG5pZiAoY2FuUmVtb3ZlU3ZnVmlld0JveEF0dHJpYnV0ZSl7XG4gIHByb3RvdHlwZS5yZW1vdmVBdHRyaWJ1dGUgPSBmdW5jdGlvbihlbGVtZW50LCBuYW1lKSB7XG4gICAgZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUobmFtZSk7XG4gIH07XG59IGVsc2Uge1xuICBwcm90b3R5cGUucmVtb3ZlQXR0cmlidXRlID0gZnVuY3Rpb24oZWxlbWVudCwgbmFtZSkge1xuICAgIGlmIChlbGVtZW50LnRhZ05hbWUgPT09ICdzdmcnICYmIG5hbWUgPT09ICd2aWV3Qm94Jykge1xuICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUobmFtZSwgbnVsbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKG5hbWUpO1xuICAgIH1cbiAgfTtcbn1cblxucHJvdG90eXBlLnNldFByb3BlcnR5U3RyaWN0ID0gZnVuY3Rpb24oZWxlbWVudCwgbmFtZSwgdmFsdWUpIHtcbiAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICB2YWx1ZSA9IG51bGw7XG4gIH1cblxuICBpZiAodmFsdWUgPT09IG51bGwgJiYgKG5hbWUgPT09ICd2YWx1ZScgfHwgbmFtZSA9PT0gJ3R5cGUnIHx8IG5hbWUgPT09ICdzcmMnKSkge1xuICAgIHZhbHVlID0gJyc7XG4gIH1cblxuICBlbGVtZW50W25hbWVdID0gdmFsdWU7XG59O1xuXG5wcm90b3R5cGUuZ2V0UHJvcGVydHlTdHJpY3QgPSBmdW5jdGlvbihlbGVtZW50LCBuYW1lKSB7XG4gIHJldHVybiBlbGVtZW50W25hbWVdO1xufTtcblxucHJvdG90eXBlLnNldFByb3BlcnR5ID0gZnVuY3Rpb24oZWxlbWVudCwgbmFtZSwgdmFsdWUsIG5hbWVzcGFjZSkge1xuICBpZiAoZWxlbWVudC5uYW1lc3BhY2VVUkkgPT09IHN2Z05hbWVzcGFjZSkge1xuICAgIGlmIChpc0F0dHJSZW1vdmFsVmFsdWUodmFsdWUpKSB7XG4gICAgICBlbGVtZW50LnJlbW92ZUF0dHJpYnV0ZShuYW1lKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKG5hbWVzcGFjZSkge1xuICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZU5TKG5hbWVzcGFjZSwgbmFtZSwgdmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUobmFtZSwgdmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICB2YXIgeyBub3JtYWxpemVkICwgdHlwZSB9ID0gbm9ybWFsaXplUHJvcGVydHkoZWxlbWVudCwgbmFtZSk7XG4gICAgaWYgKHR5cGUgPT09ICdwcm9wJykge1xuICAgICAgZWxlbWVudFtub3JtYWxpemVkXSA9IHZhbHVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoaXNBdHRyUmVtb3ZhbFZhbHVlKHZhbHVlKSkge1xuICAgICAgICBlbGVtZW50LnJlbW92ZUF0dHJpYnV0ZShuYW1lKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChuYW1lc3BhY2UgJiYgZWxlbWVudC5zZXRBdHRyaWJ1dGVOUykge1xuICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlTlMobmFtZXNwYWNlLCBuYW1lLCB2YWx1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUobmFtZSwgdmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG5pZiAoZG9jICYmIGRvYy5jcmVhdGVFbGVtZW50TlMpIHtcbiAgLy8gT25seSBvcHQgaW50byBuYW1lc3BhY2UgZGV0ZWN0aW9uIGlmIGEgY29udGV4dHVhbEVsZW1lbnRcbiAgLy8gaXMgcGFzc2VkLlxuICBwcm90b3R5cGUuY3JlYXRlRWxlbWVudCA9IGZ1bmN0aW9uKHRhZ05hbWUsIGNvbnRleHR1YWxFbGVtZW50KSB7XG4gICAgdmFyIG5hbWVzcGFjZSA9IHRoaXMubmFtZXNwYWNlO1xuICAgIGlmIChjb250ZXh0dWFsRWxlbWVudCkge1xuICAgICAgaWYgKHRhZ05hbWUgPT09ICdzdmcnKSB7XG4gICAgICAgIG5hbWVzcGFjZSA9IHN2Z05hbWVzcGFjZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5hbWVzcGFjZSA9IGludGVyaW9yTmFtZXNwYWNlKGNvbnRleHR1YWxFbGVtZW50KTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKG5hbWVzcGFjZSkge1xuICAgICAgcmV0dXJuIHRoaXMuZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKG5hbWVzcGFjZSwgdGFnTmFtZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnTmFtZSk7XG4gICAgfVxuICB9O1xuICBwcm90b3R5cGUuc2V0QXR0cmlidXRlTlMgPSBmdW5jdGlvbihlbGVtZW50LCBuYW1lc3BhY2UsIG5hbWUsIHZhbHVlKSB7XG4gICAgZWxlbWVudC5zZXRBdHRyaWJ1dGVOUyhuYW1lc3BhY2UsIG5hbWUsIFN0cmluZyh2YWx1ZSkpO1xuICB9O1xufSBlbHNlIHtcbiAgcHJvdG90eXBlLmNyZWF0ZUVsZW1lbnQgPSBmdW5jdGlvbih0YWdOYW1lKSB7XG4gICAgcmV0dXJuIHRoaXMuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWdOYW1lKTtcbiAgfTtcbiAgcHJvdG90eXBlLnNldEF0dHJpYnV0ZU5TID0gZnVuY3Rpb24oZWxlbWVudCwgbmFtZXNwYWNlLCBuYW1lLCB2YWx1ZSkge1xuICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKG5hbWUsIFN0cmluZyh2YWx1ZSkpO1xuICB9O1xufVxuXG5wcm90b3R5cGUuYWRkQ2xhc3NlcyA9IGFkZENsYXNzZXM7XG5wcm90b3R5cGUucmVtb3ZlQ2xhc3NlcyA9IHJlbW92ZUNsYXNzZXM7XG5cbnByb3RvdHlwZS5zZXROYW1lc3BhY2UgPSBmdW5jdGlvbihucykge1xuICB0aGlzLm5hbWVzcGFjZSA9IG5zO1xufTtcblxucHJvdG90eXBlLmRldGVjdE5hbWVzcGFjZSA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgdGhpcy5uYW1lc3BhY2UgPSBpbnRlcmlvck5hbWVzcGFjZShlbGVtZW50KTtcbn07XG5cbnByb3RvdHlwZS5jcmVhdGVEb2N1bWVudEZyYWdtZW50ID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXMuZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xufTtcblxucHJvdG90eXBlLmNyZWF0ZVRleHROb2RlID0gZnVuY3Rpb24odGV4dCl7XG4gIHJldHVybiB0aGlzLmRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRleHQpO1xufTtcblxucHJvdG90eXBlLmNyZWF0ZUNvbW1lbnQgPSBmdW5jdGlvbih0ZXh0KXtcbiAgcmV0dXJuIHRoaXMuZG9jdW1lbnQuY3JlYXRlQ29tbWVudCh0ZXh0KTtcbn07XG5cbnByb3RvdHlwZS5yZXBhaXJDbG9uZWROb2RlID0gZnVuY3Rpb24oZWxlbWVudCwgYmxhbmtDaGlsZFRleHROb2RlcywgaXNDaGVja2VkKXtcbiAgaWYgKGRlbGV0ZXNCbGFua1RleHROb2RlcyAmJiBibGFua0NoaWxkVGV4dE5vZGVzLmxlbmd0aCA+IDApIHtcbiAgICBmb3IgKHZhciBpPTAsIGxlbj1ibGFua0NoaWxkVGV4dE5vZGVzLmxlbmd0aDtpPGxlbjtpKyspe1xuICAgICAgdmFyIHRleHROb2RlID0gdGhpcy5kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnJyksXG4gICAgICAgICAgb2Zmc2V0ID0gYmxhbmtDaGlsZFRleHROb2Rlc1tpXSxcbiAgICAgICAgICBiZWZvcmUgPSB0aGlzLmNoaWxkQXRJbmRleChlbGVtZW50LCBvZmZzZXQpO1xuICAgICAgaWYgKGJlZm9yZSkge1xuICAgICAgICBlbGVtZW50Lmluc2VydEJlZm9yZSh0ZXh0Tm9kZSwgYmVmb3JlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQodGV4dE5vZGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBpZiAoaWdub3Jlc0NoZWNrZWRBdHRyaWJ1dGUgJiYgaXNDaGVja2VkKSB7XG4gICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2NoZWNrZWQnLCAnY2hlY2tlZCcpO1xuICB9XG59O1xuXG5wcm90b3R5cGUuY2xvbmVOb2RlID0gZnVuY3Rpb24oZWxlbWVudCwgZGVlcCl7XG4gIHZhciBjbG9uZSA9IGVsZW1lbnQuY2xvbmVOb2RlKCEhZGVlcCk7XG4gIHJldHVybiBjbG9uZTtcbn07XG5cbnByb3RvdHlwZS5BdHRyTW9ycGhDbGFzcyA9IEF0dHJNb3JwaDtcblxucHJvdG90eXBlLmNyZWF0ZUF0dHJNb3JwaCA9IGZ1bmN0aW9uKGVsZW1lbnQsIGF0dHJOYW1lLCBuYW1lc3BhY2Upe1xuICByZXR1cm4gdGhpcy5BdHRyTW9ycGhDbGFzcy5jcmVhdGUoZWxlbWVudCwgYXR0ck5hbWUsIHRoaXMsIG5hbWVzcGFjZSk7XG59O1xuXG5wcm90b3R5cGUuRWxlbWVudE1vcnBoQ2xhc3MgPSBFbGVtZW50TW9ycGg7XG5cbnByb3RvdHlwZS5jcmVhdGVFbGVtZW50TW9ycGggPSBmdW5jdGlvbihlbGVtZW50LCBuYW1lc3BhY2Upe1xuICByZXR1cm4gbmV3IHRoaXMuRWxlbWVudE1vcnBoQ2xhc3MoZWxlbWVudCwgdGhpcywgbmFtZXNwYWNlKTtcbn07XG5cbnByb3RvdHlwZS5jcmVhdGVVbnNhZmVBdHRyTW9ycGggPSBmdW5jdGlvbihlbGVtZW50LCBhdHRyTmFtZSwgbmFtZXNwYWNlKXtcbiAgdmFyIG1vcnBoID0gdGhpcy5jcmVhdGVBdHRyTW9ycGgoZWxlbWVudCwgYXR0ck5hbWUsIG5hbWVzcGFjZSk7XG4gIG1vcnBoLmVzY2FwZWQgPSBmYWxzZTtcbiAgcmV0dXJuIG1vcnBoO1xufTtcblxucHJvdG90eXBlLk1vcnBoQ2xhc3MgPSBNb3JwaDtcblxucHJvdG90eXBlLmNyZWF0ZU1vcnBoID0gZnVuY3Rpb24ocGFyZW50LCBzdGFydCwgZW5kLCBjb250ZXh0dWFsRWxlbWVudCl7XG4gIGlmIChjb250ZXh0dWFsRWxlbWVudCAmJiBjb250ZXh0dWFsRWxlbWVudC5ub2RlVHlwZSA9PT0gMTEpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgcGFzcyBhIGZyYWdtZW50IGFzIHRoZSBjb250ZXh0dWFsIGVsZW1lbnQgdG8gY3JlYXRlTW9ycGhcIik7XG4gIH1cblxuICBpZiAoIWNvbnRleHR1YWxFbGVtZW50ICYmIHBhcmVudCAmJiBwYXJlbnQubm9kZVR5cGUgPT09IDEpIHtcbiAgICBjb250ZXh0dWFsRWxlbWVudCA9IHBhcmVudDtcbiAgfVxuICB2YXIgbW9ycGggPSBuZXcgdGhpcy5Nb3JwaENsYXNzKHRoaXMsIGNvbnRleHR1YWxFbGVtZW50KTtcbiAgbW9ycGguZmlyc3ROb2RlID0gc3RhcnQ7XG4gIG1vcnBoLmxhc3ROb2RlID0gZW5kO1xuICByZXR1cm4gbW9ycGg7XG59O1xuXG5wcm90b3R5cGUuY3JlYXRlRnJhZ21lbnRNb3JwaCA9IGZ1bmN0aW9uKGNvbnRleHR1YWxFbGVtZW50KSB7XG4gIGlmIChjb250ZXh0dWFsRWxlbWVudCAmJiBjb250ZXh0dWFsRWxlbWVudC5ub2RlVHlwZSA9PT0gMTEpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgcGFzcyBhIGZyYWdtZW50IGFzIHRoZSBjb250ZXh0dWFsIGVsZW1lbnQgdG8gY3JlYXRlTW9ycGhcIik7XG4gIH1cblxuICB2YXIgZnJhZ21lbnQgPSB0aGlzLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgcmV0dXJuIE1vcnBoLmNyZWF0ZSh0aGlzLCBjb250ZXh0dWFsRWxlbWVudCwgZnJhZ21lbnQpO1xufTtcblxucHJvdG90eXBlLnJlcGxhY2VDb250ZW50V2l0aE1vcnBoID0gZnVuY3Rpb24oZWxlbWVudCkgIHtcbiAgdmFyIGZpcnN0Q2hpbGQgPSBlbGVtZW50LmZpcnN0Q2hpbGQ7XG5cbiAgaWYgKCFmaXJzdENoaWxkKSB7XG4gICAgdmFyIGNvbW1lbnQgPSB0aGlzLmNyZWF0ZUNvbW1lbnQoJycpO1xuICAgIHRoaXMuYXBwZW5kQ2hpbGQoZWxlbWVudCwgY29tbWVudCk7XG4gICAgcmV0dXJuIE1vcnBoLmNyZWF0ZSh0aGlzLCBlbGVtZW50LCBjb21tZW50KTtcbiAgfSBlbHNlIHtcbiAgICB2YXIgbW9ycGggPSBNb3JwaC5hdHRhY2godGhpcywgZWxlbWVudCwgZmlyc3RDaGlsZCwgZWxlbWVudC5sYXN0Q2hpbGQpO1xuICAgIG1vcnBoLmNsZWFyKCk7XG4gICAgcmV0dXJuIG1vcnBoO1xuICB9XG59O1xuXG5wcm90b3R5cGUuY3JlYXRlVW5zYWZlTW9ycGggPSBmdW5jdGlvbihwYXJlbnQsIHN0YXJ0LCBlbmQsIGNvbnRleHR1YWxFbGVtZW50KXtcbiAgdmFyIG1vcnBoID0gdGhpcy5jcmVhdGVNb3JwaChwYXJlbnQsIHN0YXJ0LCBlbmQsIGNvbnRleHR1YWxFbGVtZW50KTtcbiAgbW9ycGgucGFyc2VUZXh0QXNIVE1MID0gdHJ1ZTtcbiAgcmV0dXJuIG1vcnBoO1xufTtcblxuLy8gVGhpcyBoZWxwZXIgaXMganVzdCB0byBrZWVwIHRoZSB0ZW1wbGF0ZXMgZ29vZCBsb29raW5nLFxuLy8gcGFzc2luZyBpbnRlZ2VycyBpbnN0ZWFkIG9mIGVsZW1lbnQgcmVmZXJlbmNlcy5cbnByb3RvdHlwZS5jcmVhdGVNb3JwaEF0ID0gZnVuY3Rpb24ocGFyZW50LCBzdGFydEluZGV4LCBlbmRJbmRleCwgY29udGV4dHVhbEVsZW1lbnQpe1xuICB2YXIgc2luZ2xlID0gc3RhcnRJbmRleCA9PT0gZW5kSW5kZXg7XG4gIHZhciBzdGFydCA9IHRoaXMuY2hpbGRBdEluZGV4KHBhcmVudCwgc3RhcnRJbmRleCk7XG4gIHZhciBlbmQgPSBzaW5nbGUgPyBzdGFydCA6IHRoaXMuY2hpbGRBdEluZGV4KHBhcmVudCwgZW5kSW5kZXgpO1xuICByZXR1cm4gdGhpcy5jcmVhdGVNb3JwaChwYXJlbnQsIHN0YXJ0LCBlbmQsIGNvbnRleHR1YWxFbGVtZW50KTtcbn07XG5cbnByb3RvdHlwZS5jcmVhdGVVbnNhZmVNb3JwaEF0ID0gZnVuY3Rpb24ocGFyZW50LCBzdGFydEluZGV4LCBlbmRJbmRleCwgY29udGV4dHVhbEVsZW1lbnQpIHtcbiAgdmFyIG1vcnBoID0gdGhpcy5jcmVhdGVNb3JwaEF0KHBhcmVudCwgc3RhcnRJbmRleCwgZW5kSW5kZXgsIGNvbnRleHR1YWxFbGVtZW50KTtcbiAgbW9ycGgucGFyc2VUZXh0QXNIVE1MID0gdHJ1ZTtcbiAgcmV0dXJuIG1vcnBoO1xufTtcblxucHJvdG90eXBlLmluc2VydE1vcnBoQmVmb3JlID0gZnVuY3Rpb24oZWxlbWVudCwgcmVmZXJlbmNlQ2hpbGQsIGNvbnRleHR1YWxFbGVtZW50KSB7XG4gIHZhciBpbnNlcnRpb24gPSB0aGlzLmRvY3VtZW50LmNyZWF0ZUNvbW1lbnQoJycpO1xuICBlbGVtZW50Lmluc2VydEJlZm9yZShpbnNlcnRpb24sIHJlZmVyZW5jZUNoaWxkKTtcbiAgcmV0dXJuIHRoaXMuY3JlYXRlTW9ycGgoZWxlbWVudCwgaW5zZXJ0aW9uLCBpbnNlcnRpb24sIGNvbnRleHR1YWxFbGVtZW50KTtcbn07XG5cbnByb3RvdHlwZS5hcHBlbmRNb3JwaCA9IGZ1bmN0aW9uKGVsZW1lbnQsIGNvbnRleHR1YWxFbGVtZW50KSB7XG4gIHZhciBpbnNlcnRpb24gPSB0aGlzLmRvY3VtZW50LmNyZWF0ZUNvbW1lbnQoJycpO1xuICBlbGVtZW50LmFwcGVuZENoaWxkKGluc2VydGlvbik7XG4gIHJldHVybiB0aGlzLmNyZWF0ZU1vcnBoKGVsZW1lbnQsIGluc2VydGlvbiwgaW5zZXJ0aW9uLCBjb250ZXh0dWFsRWxlbWVudCk7XG59O1xuXG5wcm90b3R5cGUuaW5zZXJ0Qm91bmRhcnkgPSBmdW5jdGlvbihmcmFnbWVudCwgaW5kZXgpIHtcbiAgLy8gdGhpcyB3aWxsIGFsd2F5cyBiZSBudWxsIG9yIGZpcnN0Q2hpbGRcbiAgdmFyIGNoaWxkID0gaW5kZXggPT09IG51bGwgPyBudWxsIDogdGhpcy5jaGlsZEF0SW5kZXgoZnJhZ21lbnQsIGluZGV4KTtcbiAgdGhpcy5pbnNlcnRCZWZvcmUoZnJhZ21lbnQsIHRoaXMuY3JlYXRlVGV4dE5vZGUoJycpLCBjaGlsZCk7XG59O1xuXG5wcm90b3R5cGUuc2V0TW9ycGhIVE1MID0gZnVuY3Rpb24obW9ycGgsIGh0bWwpIHtcbiAgbW9ycGguc2V0SFRNTChodG1sKTtcbn07XG5cbnByb3RvdHlwZS5wYXJzZUhUTUwgPSBmdW5jdGlvbihodG1sLCBjb250ZXh0dWFsRWxlbWVudCkge1xuICB2YXIgY2hpbGROb2RlcztcblxuICBpZiAoaW50ZXJpb3JOYW1lc3BhY2UoY29udGV4dHVhbEVsZW1lbnQpID09PSBzdmdOYW1lc3BhY2UpIHtcbiAgICBjaGlsZE5vZGVzID0gYnVpbGRTVkdET00oaHRtbCwgdGhpcyk7XG4gIH0gZWxzZSB7XG4gICAgdmFyIG5vZGVzID0gYnVpbGRIVE1MRE9NKGh0bWwsIGNvbnRleHR1YWxFbGVtZW50LCB0aGlzKTtcbiAgICBpZiAoZGV0ZWN0T21pdHRlZFN0YXJ0VGFnKGh0bWwsIGNvbnRleHR1YWxFbGVtZW50KSkge1xuICAgICAgdmFyIG5vZGUgPSBub2Rlc1swXTtcbiAgICAgIHdoaWxlIChub2RlICYmIG5vZGUubm9kZVR5cGUgIT09IDEpIHtcbiAgICAgICAgbm9kZSA9IG5vZGUubmV4dFNpYmxpbmc7XG4gICAgICB9XG4gICAgICBjaGlsZE5vZGVzID0gbm9kZS5jaGlsZE5vZGVzO1xuICAgIH0gZWxzZSB7XG4gICAgICBjaGlsZE5vZGVzID0gbm9kZXM7XG4gICAgfVxuICB9XG5cbiAgLy8gQ29weSBub2RlIGxpc3QgdG8gYSBmcmFnbWVudC5cbiAgdmFyIGZyYWdtZW50ID0gdGhpcy5kb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG5cbiAgaWYgKGNoaWxkTm9kZXMgJiYgY2hpbGROb2Rlcy5sZW5ndGggPiAwKSB7XG4gICAgdmFyIGN1cnJlbnROb2RlID0gY2hpbGROb2Rlc1swXTtcblxuICAgIC8vIFdlIHByZXBlbmQgYW4gPG9wdGlvbj4gdG8gPHNlbGVjdD4gYm94ZXMgdG8gYWJzb3JiIGFueSBicm93c2VyIGJ1Z3NcbiAgICAvLyByZWxhdGVkIHRvIGF1dG8tc2VsZWN0IGJlaGF2aW9yLiBTa2lwIHBhc3QgaXQuXG4gICAgaWYgKGNvbnRleHR1YWxFbGVtZW50LnRhZ05hbWUgPT09ICdTRUxFQ1QnKSB7XG4gICAgICBjdXJyZW50Tm9kZSA9IGN1cnJlbnROb2RlLm5leHRTaWJsaW5nO1xuICAgIH1cblxuICAgIHdoaWxlIChjdXJyZW50Tm9kZSkge1xuICAgICAgdmFyIHRlbXBOb2RlID0gY3VycmVudE5vZGU7XG4gICAgICBjdXJyZW50Tm9kZSA9IGN1cnJlbnROb2RlLm5leHRTaWJsaW5nO1xuXG4gICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZCh0ZW1wTm9kZSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGZyYWdtZW50O1xufTtcblxudmFyIG5vZGVVUkw7XG52YXIgcGFyc2luZ05vZGU7XG5cbmZ1bmN0aW9uIGluc3RhbGxFbnZpcm9ubWVudFNwZWNpZmljTWV0aG9kcyhkb21IZWxwZXIpIHtcbiAgdmFyIHByb3RvY29sID0gYnJvd3NlclByb3RvY29sRm9yVVJMLmNhbGwoZG9tSGVscGVyLCAnZm9vYmFyOmJheicpO1xuXG4gIC8vIFRlc3QgdG8gc2VlIGlmIG91ciBET00gaW1wbGVtZW50YXRpb24gcGFyc2VzXG4gIC8vIGFuZCBub3JtYWxpemVzIFVSTHMuXG4gIGlmIChwcm90b2NvbCA9PT0gJ2Zvb2JhcjonKSB7XG4gICAgLy8gU3dhcCBpbiB0aGUgbWV0aG9kIHRoYXQgZG9lc24ndCBkbyB0aGlzIHRlc3Qgbm93IHRoYXRcbiAgICAvLyB3ZSBrbm93IGl0IHdvcmtzLlxuICAgIGRvbUhlbHBlci5wcm90b2NvbEZvclVSTCA9IGJyb3dzZXJQcm90b2NvbEZvclVSTDtcbiAgfSBlbHNlIGlmICh0eXBlb2YgVVJMID09PSAnb2JqZWN0Jykge1xuICAgIC8vIFVSTCBnbG9iYWxseSBwcm92aWRlZCwgbGlrZWx5IGZyb20gRmFzdEJvb3QncyBzYW5kYm94XG4gICAgbm9kZVVSTCA9IFVSTDtcbiAgICBkb21IZWxwZXIucHJvdG9jb2xGb3JVUkwgPSBub2RlUHJvdG9jb2xGb3JVUkw7XG4gIH0gZWxzZSBpZiAodHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZS5yZXF1aXJlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgLy8gT3RoZXJ3aXNlLCB3ZSBuZWVkIHRvIGZhbGwgYmFjayB0byBvdXIgb3duIFVSTCBwYXJzaW5nLlxuICAgIC8vIEdsb2JhbCBgcmVxdWlyZWAgaXMgc2hhZG93ZWQgYnkgRW1iZXIncyBsb2FkZXIgc28gd2UgaGF2ZSB0byB1c2UgdGhlIGZ1bGx5XG4gICAgLy8gcXVhbGlmaWVkIGBtb2R1bGUucmVxdWlyZWAuXG4gICAgbm9kZVVSTCA9IG1vZHVsZS5yZXF1aXJlKCd1cmwnKTtcbiAgICBkb21IZWxwZXIucHJvdG9jb2xGb3JVUkwgPSBub2RlUHJvdG9jb2xGb3JVUkw7XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRE9NIEhlbHBlciBjb3VsZCBub3QgZmluZCB2YWxpZCBVUkwgcGFyc2luZyBtZWNoYW5pc21cIik7XG4gIH1cblxuICAvLyBBIFNpbXBsZURPTS1zcGVjaWZpYyBleHRlbnNpb24gdGhhdCBhbGxvd3MgdXMgdG8gcGxhY2UgSFRNTCBkaXJlY3RseVxuICAvLyBpbnRvIHRoZSBET00gdHJlZSwgZm9yIHdoZW4gdGhlIG91dHB1dCB0YXJnZXQgaXMgYWx3YXlzIHNlcmlhbGl6ZWQgSFRNTC5cbiAgaWYgKGRvbUhlbHBlci5kb2N1bWVudC5jcmVhdGVSYXdIVE1MU2VjdGlvbikge1xuICAgIGRvbUhlbHBlci5zZXRNb3JwaEhUTUwgPSBub2RlU2V0TW9ycGhIVE1MO1xuICB9XG59XG5cbmZ1bmN0aW9uIG5vZGVTZXRNb3JwaEhUTUwobW9ycGgsIGh0bWwpIHtcbiAgdmFyIHNlY3Rpb24gPSB0aGlzLmRvY3VtZW50LmNyZWF0ZVJhd0hUTUxTZWN0aW9uKGh0bWwpO1xuICBtb3JwaC5zZXROb2RlKHNlY3Rpb24pO1xufVxuXG5mdW5jdGlvbiBicm93c2VyUHJvdG9jb2xGb3JVUkwodXJsKSB7XG4gIGlmICghcGFyc2luZ05vZGUpIHtcbiAgICBwYXJzaW5nTm9kZSA9IHRoaXMuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICB9XG5cbiAgcGFyc2luZ05vZGUuaHJlZiA9IHVybDtcbiAgcmV0dXJuIHBhcnNpbmdOb2RlLnByb3RvY29sO1xufVxuXG5mdW5jdGlvbiBub2RlUHJvdG9jb2xGb3JVUkwodXJsKSB7XG4gIHZhciBwcm90b2NvbCA9IG5vZGVVUkwucGFyc2UodXJsKS5wcm90b2NvbDtcbiAgcmV0dXJuIChwcm90b2NvbCA9PT0gbnVsbCkgPyAnOicgOiBwcm90b2NvbDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgRE9NSGVscGVyO1xuIl19