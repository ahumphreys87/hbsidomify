exports.__esModule = true;

var _utils = require("./utils");

var _htmlbarsUtilQuoting = require("../htmlbars-util/quoting");

var svgNamespace = "http://www.w3.org/2000/svg",

// http://www.w3.org/html/wg/drafts/html/master/syntax.html#html-integration-point
svgHTMLIntegrationPoints = { 'foreignObject': true, 'desc': true, 'title': true };

function FragmentJavaScriptCompiler() {
  this.source = [];
  this.depth = -1;
}

exports.default = FragmentJavaScriptCompiler;

FragmentJavaScriptCompiler.prototype.compile = function (opcodes, options) {
  this.source.length = 0;
  this.depth = -1;
  this.indent = options && options.indent || "";
  this.namespaceFrameStack = [{ namespace: null, depth: null }];
  this.domNamespace = null;

  this.source.push('function buildFragment(dom) {\n');
  _utils.processOpcodes(this, opcodes);
  this.source.push(this.indent + '}');

  return this.source.join('');
};

FragmentJavaScriptCompiler.prototype.createFragment = function () {
  var el = 'el' + ++this.depth;
  this.source.push(this.indent + '  var ' + el + ' = dom.createDocumentFragment();\n');
};

FragmentJavaScriptCompiler.prototype.createElement = function (tagName) {
  var el = 'el' + ++this.depth;
  if (tagName === 'svg') {
    this.pushNamespaceFrame({ namespace: svgNamespace, depth: this.depth });
  }
  this.ensureNamespace();
  this.source.push(this.indent + '  var ' + el + ' = dom.createElement(' + _htmlbarsUtilQuoting.string(tagName) + ');\n');
  if (svgHTMLIntegrationPoints[tagName]) {
    this.pushNamespaceFrame({ namespace: null, depth: this.depth });
  }
};

FragmentJavaScriptCompiler.prototype.createText = function (str) {
  var el = 'el' + ++this.depth;
  this.source.push(this.indent + '  var ' + el + ' = dom.createTextNode(' + _htmlbarsUtilQuoting.string(str) + ');\n');
};

FragmentJavaScriptCompiler.prototype.createComment = function (str) {
  var el = 'el' + ++this.depth;
  this.source.push(this.indent + '  var ' + el + ' = dom.createComment(' + _htmlbarsUtilQuoting.string(str) + ');\n');
};

FragmentJavaScriptCompiler.prototype.returnNode = function () {
  var el = 'el' + this.depth;
  this.source.push(this.indent + '  return ' + el + ';\n');
};

FragmentJavaScriptCompiler.prototype.setAttribute = function (name, value, namespace) {
  var el = 'el' + this.depth;
  if (namespace) {
    this.source.push(this.indent + '  dom.setAttributeNS(' + el + ',' + _htmlbarsUtilQuoting.string(namespace) + ',' + _htmlbarsUtilQuoting.string(name) + ',' + _htmlbarsUtilQuoting.string(value) + ');\n');
  } else {
    this.source.push(this.indent + '  dom.setAttribute(' + el + ',' + _htmlbarsUtilQuoting.string(name) + ',' + _htmlbarsUtilQuoting.string(value) + ');\n');
  }
};

FragmentJavaScriptCompiler.prototype.appendChild = function () {
  if (this.depth === this.getCurrentNamespaceFrame().depth) {
    this.popNamespaceFrame();
  }
  var child = 'el' + this.depth--;
  var el = 'el' + this.depth;
  this.source.push(this.indent + '  dom.appendChild(' + el + ', ' + child + ');\n');
};

FragmentJavaScriptCompiler.prototype.getCurrentNamespaceFrame = function () {
  return this.namespaceFrameStack[this.namespaceFrameStack.length - 1];
};

FragmentJavaScriptCompiler.prototype.pushNamespaceFrame = function (frame) {
  this.namespaceFrameStack.push(frame);
};

FragmentJavaScriptCompiler.prototype.popNamespaceFrame = function () {
  return this.namespaceFrameStack.pop();
};

FragmentJavaScriptCompiler.prototype.ensureNamespace = function () {
  var correctNamespace = this.getCurrentNamespaceFrame().namespace;
  if (this.domNamespace !== correctNamespace) {
    this.source.push(this.indent + '  dom.setNamespace(' + (correctNamespace ? _htmlbarsUtilQuoting.string(correctNamespace) : 'null') + ');\n');
    this.domNamespace = correctNamespace;
  }
};
module.exports = exports.default;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0bWxiYXJzLWNvbXBpbGVyL2ZyYWdtZW50LWphdmFzY3JpcHQtY29tcGlsZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7cUJBQStCLFNBQVM7O21DQUNqQiwwQkFBMEI7O0FBRWpELElBQUksWUFBWSxHQUFHLDRCQUE0Qjs7O0FBRTNDLHdCQUF3QixHQUFHLEVBQUMsZUFBZSxFQUFDLElBQUksRUFBRSxNQUFNLEVBQUMsSUFBSSxFQUFFLE9BQU8sRUFBQyxJQUFJLEVBQUMsQ0FBQzs7QUFHakYsU0FBUywwQkFBMEIsR0FBRztBQUNwQyxNQUFJLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQztBQUNqQixNQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO0NBQ2pCOztrQkFFYywwQkFBMEI7O0FBRXpDLDBCQUEwQixDQUFDLFNBQVMsQ0FBQyxPQUFPLEdBQUcsVUFBUyxPQUFPLEVBQUUsT0FBTyxFQUFFO0FBQ3hFLE1BQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztBQUN2QixNQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO0FBQ2hCLE1BQUksQ0FBQyxNQUFNLEdBQUcsQUFBQyxPQUFPLElBQUksT0FBTyxDQUFDLE1BQU0sSUFBSyxFQUFFLENBQUM7QUFDaEQsTUFBSSxDQUFDLG1CQUFtQixHQUFHLENBQUMsRUFBQyxTQUFTLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDO0FBQzVELE1BQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDOztBQUV6QixNQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDO0FBQ3BELHdCQUFlLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztBQUM5QixNQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFDLEdBQUcsQ0FBQyxDQUFDOztBQUVsQyxTQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0NBQzdCLENBQUM7O0FBRUYsMEJBQTBCLENBQUMsU0FBUyxDQUFDLGNBQWMsR0FBRyxZQUFXO0FBQy9ELE1BQUksRUFBRSxHQUFHLElBQUksR0FBRSxFQUFFLElBQUksQ0FBQyxLQUFLLEFBQUMsQ0FBQztBQUM3QixNQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFDLFFBQVEsR0FBQyxFQUFFLEdBQUMsb0NBQW9DLENBQUMsQ0FBQztDQUNoRixDQUFDOztBQUVGLDBCQUEwQixDQUFDLFNBQVMsQ0FBQyxhQUFhLEdBQUcsVUFBUyxPQUFPLEVBQUU7QUFDckUsTUFBSSxFQUFFLEdBQUcsSUFBSSxHQUFFLEVBQUUsSUFBSSxDQUFDLEtBQUssQUFBQyxDQUFDO0FBQzdCLE1BQUksT0FBTyxLQUFLLEtBQUssRUFBRTtBQUNyQixRQUFJLENBQUMsa0JBQWtCLENBQUMsRUFBQyxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxFQUFDLENBQUMsQ0FBQztHQUN2RTtBQUNELE1BQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztBQUN2QixNQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFDLFFBQVEsR0FBQyxFQUFFLEdBQUMsdUJBQXVCLEdBQUMsNEJBQU8sT0FBTyxDQUFDLEdBQUMsTUFBTSxDQUFDLENBQUM7QUFDekYsTUFBSSx3QkFBd0IsQ0FBQyxPQUFPLENBQUMsRUFBRTtBQUNyQyxRQUFJLENBQUMsa0JBQWtCLENBQUMsRUFBQyxTQUFTLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxFQUFDLENBQUMsQ0FBQztHQUMvRDtDQUNGLENBQUM7O0FBRUYsMEJBQTBCLENBQUMsU0FBUyxDQUFDLFVBQVUsR0FBRyxVQUFTLEdBQUcsRUFBRTtBQUM5RCxNQUFJLEVBQUUsR0FBRyxJQUFJLEdBQUUsRUFBRSxJQUFJLENBQUMsS0FBSyxBQUFDLENBQUM7QUFDN0IsTUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBQyxRQUFRLEdBQUMsRUFBRSxHQUFDLHdCQUF3QixHQUFDLDRCQUFPLEdBQUcsQ0FBQyxHQUFDLE1BQU0sQ0FBQyxDQUFDO0NBQ3ZGLENBQUM7O0FBRUYsMEJBQTBCLENBQUMsU0FBUyxDQUFDLGFBQWEsR0FBRyxVQUFTLEdBQUcsRUFBRTtBQUNqRSxNQUFJLEVBQUUsR0FBRyxJQUFJLEdBQUUsRUFBRSxJQUFJLENBQUMsS0FBSyxBQUFDLENBQUM7QUFDN0IsTUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBQyxRQUFRLEdBQUMsRUFBRSxHQUFDLHVCQUF1QixHQUFDLDRCQUFPLEdBQUcsQ0FBQyxHQUFDLE1BQU0sQ0FBQyxDQUFDO0NBQ3RGLENBQUM7O0FBRUYsMEJBQTBCLENBQUMsU0FBUyxDQUFDLFVBQVUsR0FBRyxZQUFXO0FBQzNELE1BQUksRUFBRSxHQUFHLElBQUksR0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO0FBQ3pCLE1BQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUMsV0FBVyxHQUFDLEVBQUUsR0FBQyxLQUFLLENBQUMsQ0FBQztDQUNwRCxDQUFDOztBQUVGLDBCQUEwQixDQUFDLFNBQVMsQ0FBQyxZQUFZLEdBQUcsVUFBUyxJQUFJLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRTtBQUNuRixNQUFJLEVBQUUsR0FBRyxJQUFJLEdBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztBQUN6QixNQUFJLFNBQVMsRUFBRTtBQUNiLFFBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUMsdUJBQXVCLEdBQUMsRUFBRSxHQUFDLEdBQUcsR0FBQyw0QkFBTyxTQUFTLENBQUMsR0FBQyxHQUFHLEdBQUMsNEJBQU8sSUFBSSxDQUFDLEdBQUMsR0FBRyxHQUFDLDRCQUFPLEtBQUssQ0FBQyxHQUFDLE1BQU0sQ0FBQyxDQUFDO0dBQzFILE1BQU07QUFDTCxRQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFDLHFCQUFxQixHQUFDLEVBQUUsR0FBQyxHQUFHLEdBQUMsNEJBQU8sSUFBSSxDQUFDLEdBQUMsR0FBRyxHQUFDLDRCQUFPLEtBQUssQ0FBQyxHQUFDLE1BQU0sQ0FBQyxDQUFDO0dBQ2xHO0NBQ0YsQ0FBQzs7QUFFRiwwQkFBMEIsQ0FBQyxTQUFTLENBQUMsV0FBVyxHQUFHLFlBQVc7QUFDNUQsTUFBSSxJQUFJLENBQUMsS0FBSyxLQUFLLElBQUksQ0FBQyx3QkFBd0IsRUFBRSxDQUFDLEtBQUssRUFBRTtBQUN4RCxRQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztHQUMxQjtBQUNELE1BQUksS0FBSyxHQUFHLElBQUksR0FBRSxJQUFJLENBQUMsS0FBSyxFQUFFLEFBQUMsQ0FBQztBQUNoQyxNQUFJLEVBQUUsR0FBRyxJQUFJLEdBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztBQUN6QixNQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFDLG9CQUFvQixHQUFDLEVBQUUsR0FBQyxJQUFJLEdBQUMsS0FBSyxHQUFDLE1BQU0sQ0FBQyxDQUFDO0NBQ3pFLENBQUM7O0FBRUYsMEJBQTBCLENBQUMsU0FBUyxDQUFDLHdCQUF3QixHQUFHLFlBQVc7QUFDekUsU0FBTyxJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sR0FBQyxDQUFDLENBQUMsQ0FBQztDQUNwRSxDQUFDOztBQUVGLDBCQUEwQixDQUFDLFNBQVMsQ0FBQyxrQkFBa0IsR0FBRyxVQUFTLEtBQUssRUFBRTtBQUN4RSxNQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0NBQ3RDLENBQUM7O0FBRUYsMEJBQTBCLENBQUMsU0FBUyxDQUFDLGlCQUFpQixHQUFHLFlBQVc7QUFDbEUsU0FBTyxJQUFJLENBQUMsbUJBQW1CLENBQUMsR0FBRyxFQUFFLENBQUM7Q0FDdkMsQ0FBQzs7QUFFRiwwQkFBMEIsQ0FBQyxTQUFTLENBQUMsZUFBZSxHQUFHLFlBQVc7QUFDaEUsTUFBSSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsd0JBQXdCLEVBQUUsQ0FBQyxTQUFTLENBQUM7QUFDakUsTUFBSSxJQUFJLENBQUMsWUFBWSxLQUFLLGdCQUFnQixFQUFFO0FBQzFDLFFBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUMscUJBQXFCLElBQUUsZ0JBQWdCLEdBQUcsNEJBQU8sZ0JBQWdCLENBQUMsR0FBRyxNQUFNLENBQUEsQUFBQyxHQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQ2xILFFBQUksQ0FBQyxZQUFZLEdBQUcsZ0JBQWdCLENBQUM7R0FDdEM7Q0FDRixDQUFDIiwiZmlsZSI6Imh0bWxiYXJzLWNvbXBpbGVyL2ZyYWdtZW50LWphdmFzY3JpcHQtY29tcGlsZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBwcm9jZXNzT3Bjb2RlcyB9IGZyb20gXCIuL3V0aWxzXCI7XG5pbXBvcnQgeyBzdHJpbmcgfSBmcm9tIFwiLi4vaHRtbGJhcnMtdXRpbC9xdW90aW5nXCI7XG5cbnZhciBzdmdOYW1lc3BhY2UgPSBcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsXG4vLyBodHRwOi8vd3d3LnczLm9yZy9odG1sL3dnL2RyYWZ0cy9odG1sL21hc3Rlci9zeW50YXguaHRtbCNodG1sLWludGVncmF0aW9uLXBvaW50XG4gICAgc3ZnSFRNTEludGVncmF0aW9uUG9pbnRzID0geydmb3JlaWduT2JqZWN0Jzp0cnVlLCAnZGVzYyc6dHJ1ZSwgJ3RpdGxlJzp0cnVlfTtcblxuXG5mdW5jdGlvbiBGcmFnbWVudEphdmFTY3JpcHRDb21waWxlcigpIHtcbiAgdGhpcy5zb3VyY2UgPSBbXTtcbiAgdGhpcy5kZXB0aCA9IC0xO1xufVxuXG5leHBvcnQgZGVmYXVsdCBGcmFnbWVudEphdmFTY3JpcHRDb21waWxlcjtcblxuRnJhZ21lbnRKYXZhU2NyaXB0Q29tcGlsZXIucHJvdG90eXBlLmNvbXBpbGUgPSBmdW5jdGlvbihvcGNvZGVzLCBvcHRpb25zKSB7XG4gIHRoaXMuc291cmNlLmxlbmd0aCA9IDA7XG4gIHRoaXMuZGVwdGggPSAtMTtcbiAgdGhpcy5pbmRlbnQgPSAob3B0aW9ucyAmJiBvcHRpb25zLmluZGVudCkgfHwgXCJcIjtcbiAgdGhpcy5uYW1lc3BhY2VGcmFtZVN0YWNrID0gW3tuYW1lc3BhY2U6IG51bGwsIGRlcHRoOiBudWxsfV07XG4gIHRoaXMuZG9tTmFtZXNwYWNlID0gbnVsbDtcblxuICB0aGlzLnNvdXJjZS5wdXNoKCdmdW5jdGlvbiBidWlsZEZyYWdtZW50KGRvbSkge1xcbicpO1xuICBwcm9jZXNzT3Bjb2Rlcyh0aGlzLCBvcGNvZGVzKTtcbiAgdGhpcy5zb3VyY2UucHVzaCh0aGlzLmluZGVudCsnfScpO1xuXG4gIHJldHVybiB0aGlzLnNvdXJjZS5qb2luKCcnKTtcbn07XG5cbkZyYWdtZW50SmF2YVNjcmlwdENvbXBpbGVyLnByb3RvdHlwZS5jcmVhdGVGcmFnbWVudCA9IGZ1bmN0aW9uKCkge1xuICB2YXIgZWwgPSAnZWwnKygrK3RoaXMuZGVwdGgpO1xuICB0aGlzLnNvdXJjZS5wdXNoKHRoaXMuaW5kZW50KycgIHZhciAnK2VsKycgPSBkb20uY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xcbicpO1xufTtcblxuRnJhZ21lbnRKYXZhU2NyaXB0Q29tcGlsZXIucHJvdG90eXBlLmNyZWF0ZUVsZW1lbnQgPSBmdW5jdGlvbih0YWdOYW1lKSB7XG4gIHZhciBlbCA9ICdlbCcrKCsrdGhpcy5kZXB0aCk7XG4gIGlmICh0YWdOYW1lID09PSAnc3ZnJykge1xuICAgIHRoaXMucHVzaE5hbWVzcGFjZUZyYW1lKHtuYW1lc3BhY2U6IHN2Z05hbWVzcGFjZSwgZGVwdGg6IHRoaXMuZGVwdGh9KTtcbiAgfVxuICB0aGlzLmVuc3VyZU5hbWVzcGFjZSgpO1xuICB0aGlzLnNvdXJjZS5wdXNoKHRoaXMuaW5kZW50KycgIHZhciAnK2VsKycgPSBkb20uY3JlYXRlRWxlbWVudCgnK3N0cmluZyh0YWdOYW1lKSsnKTtcXG4nKTtcbiAgaWYgKHN2Z0hUTUxJbnRlZ3JhdGlvblBvaW50c1t0YWdOYW1lXSkge1xuICAgIHRoaXMucHVzaE5hbWVzcGFjZUZyYW1lKHtuYW1lc3BhY2U6IG51bGwsIGRlcHRoOiB0aGlzLmRlcHRofSk7XG4gIH1cbn07XG5cbkZyYWdtZW50SmF2YVNjcmlwdENvbXBpbGVyLnByb3RvdHlwZS5jcmVhdGVUZXh0ID0gZnVuY3Rpb24oc3RyKSB7XG4gIHZhciBlbCA9ICdlbCcrKCsrdGhpcy5kZXB0aCk7XG4gIHRoaXMuc291cmNlLnB1c2godGhpcy5pbmRlbnQrJyAgdmFyICcrZWwrJyA9IGRvbS5jcmVhdGVUZXh0Tm9kZSgnK3N0cmluZyhzdHIpKycpO1xcbicpO1xufTtcblxuRnJhZ21lbnRKYXZhU2NyaXB0Q29tcGlsZXIucHJvdG90eXBlLmNyZWF0ZUNvbW1lbnQgPSBmdW5jdGlvbihzdHIpIHtcbiAgdmFyIGVsID0gJ2VsJysoKyt0aGlzLmRlcHRoKTtcbiAgdGhpcy5zb3VyY2UucHVzaCh0aGlzLmluZGVudCsnICB2YXIgJytlbCsnID0gZG9tLmNyZWF0ZUNvbW1lbnQoJytzdHJpbmcoc3RyKSsnKTtcXG4nKTtcbn07XG5cbkZyYWdtZW50SmF2YVNjcmlwdENvbXBpbGVyLnByb3RvdHlwZS5yZXR1cm5Ob2RlID0gZnVuY3Rpb24oKSB7XG4gIHZhciBlbCA9ICdlbCcrdGhpcy5kZXB0aDtcbiAgdGhpcy5zb3VyY2UucHVzaCh0aGlzLmluZGVudCsnICByZXR1cm4gJytlbCsnO1xcbicpO1xufTtcblxuRnJhZ21lbnRKYXZhU2NyaXB0Q29tcGlsZXIucHJvdG90eXBlLnNldEF0dHJpYnV0ZSA9IGZ1bmN0aW9uKG5hbWUsIHZhbHVlLCBuYW1lc3BhY2UpIHtcbiAgdmFyIGVsID0gJ2VsJyt0aGlzLmRlcHRoO1xuICBpZiAobmFtZXNwYWNlKSB7XG4gICAgdGhpcy5zb3VyY2UucHVzaCh0aGlzLmluZGVudCsnICBkb20uc2V0QXR0cmlidXRlTlMoJytlbCsnLCcrc3RyaW5nKG5hbWVzcGFjZSkrJywnK3N0cmluZyhuYW1lKSsnLCcrc3RyaW5nKHZhbHVlKSsnKTtcXG4nKTtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLnNvdXJjZS5wdXNoKHRoaXMuaW5kZW50KycgIGRvbS5zZXRBdHRyaWJ1dGUoJytlbCsnLCcrc3RyaW5nKG5hbWUpKycsJytzdHJpbmcodmFsdWUpKycpO1xcbicpO1xuICB9XG59O1xuXG5GcmFnbWVudEphdmFTY3JpcHRDb21waWxlci5wcm90b3R5cGUuYXBwZW5kQ2hpbGQgPSBmdW5jdGlvbigpIHtcbiAgaWYgKHRoaXMuZGVwdGggPT09IHRoaXMuZ2V0Q3VycmVudE5hbWVzcGFjZUZyYW1lKCkuZGVwdGgpIHtcbiAgICB0aGlzLnBvcE5hbWVzcGFjZUZyYW1lKCk7XG4gIH1cbiAgdmFyIGNoaWxkID0gJ2VsJysodGhpcy5kZXB0aC0tKTtcbiAgdmFyIGVsID0gJ2VsJyt0aGlzLmRlcHRoO1xuICB0aGlzLnNvdXJjZS5wdXNoKHRoaXMuaW5kZW50KycgIGRvbS5hcHBlbmRDaGlsZCgnK2VsKycsICcrY2hpbGQrJyk7XFxuJyk7XG59O1xuXG5GcmFnbWVudEphdmFTY3JpcHRDb21waWxlci5wcm90b3R5cGUuZ2V0Q3VycmVudE5hbWVzcGFjZUZyYW1lID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiB0aGlzLm5hbWVzcGFjZUZyYW1lU3RhY2tbdGhpcy5uYW1lc3BhY2VGcmFtZVN0YWNrLmxlbmd0aC0xXTtcbn07XG5cbkZyYWdtZW50SmF2YVNjcmlwdENvbXBpbGVyLnByb3RvdHlwZS5wdXNoTmFtZXNwYWNlRnJhbWUgPSBmdW5jdGlvbihmcmFtZSkge1xuICB0aGlzLm5hbWVzcGFjZUZyYW1lU3RhY2sucHVzaChmcmFtZSk7XG59O1xuXG5GcmFnbWVudEphdmFTY3JpcHRDb21waWxlci5wcm90b3R5cGUucG9wTmFtZXNwYWNlRnJhbWUgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIHRoaXMubmFtZXNwYWNlRnJhbWVTdGFjay5wb3AoKTtcbn07XG5cbkZyYWdtZW50SmF2YVNjcmlwdENvbXBpbGVyLnByb3RvdHlwZS5lbnN1cmVOYW1lc3BhY2UgPSBmdW5jdGlvbigpIHtcbiAgdmFyIGNvcnJlY3ROYW1lc3BhY2UgPSB0aGlzLmdldEN1cnJlbnROYW1lc3BhY2VGcmFtZSgpLm5hbWVzcGFjZTtcbiAgaWYgKHRoaXMuZG9tTmFtZXNwYWNlICE9PSBjb3JyZWN0TmFtZXNwYWNlKSB7XG4gICAgdGhpcy5zb3VyY2UucHVzaCh0aGlzLmluZGVudCsnICBkb20uc2V0TmFtZXNwYWNlKCcrKGNvcnJlY3ROYW1lc3BhY2UgPyBzdHJpbmcoY29ycmVjdE5hbWVzcGFjZSkgOiAnbnVsbCcpKycpO1xcbicpO1xuICAgIHRoaXMuZG9tTmFtZXNwYWNlID0gY29ycmVjdE5hbWVzcGFjZTtcbiAgfVxufTtcbiJdfQ==