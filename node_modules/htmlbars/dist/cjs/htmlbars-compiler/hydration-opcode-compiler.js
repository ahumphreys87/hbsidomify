exports.__esModule = true;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var _templateVisitor = require("./template-visitor");

var _templateVisitor2 = _interopRequireDefault(_templateVisitor);

var _utils = require("./utils");

var _htmlbarsUtil = require("../htmlbars-util");

var _htmlbarsUtilArrayUtils = require("../htmlbars-util/array-utils");

var _htmlbarsSyntaxUtils = require("../htmlbars-syntax/utils");

function detectIsElementChecked(element) {
  for (var i = 0, len = element.attributes.length; i < len; i++) {
    if (element.attributes[i].name === 'checked') {
      return true;
    }
  }
  return false;
}

function HydrationOpcodeCompiler() {
  this.opcodes = [];
  this.paths = [];
  this.templateId = 0;
  this.currentDOMChildIndex = 0;
  this.morphs = [];
  this.morphNum = 0;
  this.element = null;
  this.elementNum = -1;
}

exports.default = HydrationOpcodeCompiler;

HydrationOpcodeCompiler.prototype.compile = function (ast) {
  var templateVisitor = new _templateVisitor2.default();
  templateVisitor.visit(ast);

  _utils.processOpcodes(this, templateVisitor.actions);

  return this.opcodes;
};

HydrationOpcodeCompiler.prototype.accept = function (node) {
  this[node.type](node);
};

HydrationOpcodeCompiler.prototype.opcode = function (type) {
  var params = [].slice.call(arguments, 1);
  this.opcodes.push([type, params]);
};

HydrationOpcodeCompiler.prototype.startProgram = function (program, c, blankChildTextNodes) {
  this.opcodes.length = 0;
  this.paths.length = 0;
  this.morphs.length = 0;
  this.templateId = 0;
  this.currentDOMChildIndex = -1;
  this.morphNum = 0;

  var blockParams = program.blockParams || [];

  for (var i = 0; i < blockParams.length; i++) {
    this.opcode('printSetHook', blockParams[i], i);
  }

  if (blankChildTextNodes.length > 0) {
    this.opcode('repairClonedNode', blankChildTextNodes);
  }
};

HydrationOpcodeCompiler.prototype.insertBoundary = function (first) {
  this.opcode(first ? 'openBoundary' : 'closeBoundary');
};

HydrationOpcodeCompiler.prototype.endProgram = function () {
  distributeMorphs(this.morphs, this.opcodes);
};

HydrationOpcodeCompiler.prototype.text = function () {
  ++this.currentDOMChildIndex;
};

HydrationOpcodeCompiler.prototype.comment = function () {
  ++this.currentDOMChildIndex;
};

HydrationOpcodeCompiler.prototype.openElement = function (element, pos, len, mustacheCount, blankChildTextNodes) {
  distributeMorphs(this.morphs, this.opcodes);
  ++this.currentDOMChildIndex;

  this.element = this.currentDOMChildIndex;

  this.opcode('consumeParent', this.currentDOMChildIndex);

  // If our parent reference will be used more than once, cache its reference.
  if (mustacheCount > 1) {
    shareElement(this);
  }

  var isElementChecked = detectIsElementChecked(element);
  if (blankChildTextNodes.length > 0 || isElementChecked) {
    this.opcode('repairClonedNode', blankChildTextNodes, isElementChecked);
  }

  this.paths.push(this.currentDOMChildIndex);
  this.currentDOMChildIndex = -1;

  _htmlbarsUtilArrayUtils.forEach(element.attributes, this.attribute, this);
  _htmlbarsUtilArrayUtils.forEach(element.modifiers, this.elementModifier, this);
};

HydrationOpcodeCompiler.prototype.closeElement = function () {
  distributeMorphs(this.morphs, this.opcodes);
  this.opcode('popParent');
  this.currentDOMChildIndex = this.paths.pop();
};

HydrationOpcodeCompiler.prototype.mustache = function (mustache, childIndex, childCount) {
  this.pushMorphPlaceholderNode(childIndex, childCount);

  var opcode;

  if (_htmlbarsSyntaxUtils.isHelper(mustache)) {
    prepareHash(this, mustache.hash);
    prepareParams(this, mustache.params);
    preparePath(this, mustache.path);
    opcode = 'printInlineHook';
  } else {
    preparePath(this, mustache.path);
    opcode = 'printContentHook';
  }

  var morphNum = this.morphNum++;
  var start = this.currentDOMChildIndex;
  var end = this.currentDOMChildIndex;
  this.morphs.push([morphNum, this.paths.slice(), start, end, mustache.escaped]);

  this.opcode(opcode, meta(mustache));
};

function meta(node) {
  var loc = node.loc;
  if (!loc) {
    return [];
  }

  var source = loc.source;
  var start = loc.start;
  var end = loc.end;

  return ['loc', [source || null, [start.line, start.column], [end.line, end.column]]];
}

HydrationOpcodeCompiler.prototype.block = function (block, childIndex, childCount) {
  this.pushMorphPlaceholderNode(childIndex, childCount);

  prepareHash(this, block.hash);
  prepareParams(this, block.params);
  preparePath(this, block.path);

  var morphNum = this.morphNum++;
  var start = this.currentDOMChildIndex;
  var end = this.currentDOMChildIndex;
  this.morphs.push([morphNum, this.paths.slice(), start, end, true]);

  var templateId = this.templateId++;
  var inverseId = block.inverse === null ? null : this.templateId++;

  this.opcode('printBlockHook', templateId, inverseId, meta(block));
};

HydrationOpcodeCompiler.prototype.component = function (component, childIndex, childCount) {
  this.pushMorphPlaceholderNode(childIndex, childCount, component.isStatic);

  var program = component.program || {};
  var blockParams = program.blockParams || [];

  var attrs = component.attributes;
  for (var i = attrs.length - 1; i >= 0; i--) {
    var name = attrs[i].name;
    var value = attrs[i].value;

    // TODO: Introduce context specific AST nodes to avoid switching here.
    if (value.type === 'TextNode') {
      this.opcode('pushLiteral', value.chars);
    } else if (value.type === 'MustacheStatement') {
      this.accept(_htmlbarsSyntaxUtils.unwrapMustache(value));
    } else if (value.type === 'ConcatStatement') {
      prepareParams(this, value.parts);
      this.opcode('pushConcatHook', this.morphNum);
    }

    this.opcode('pushLiteral', name);
  }

  var morphNum = this.morphNum++;
  var start = this.currentDOMChildIndex;
  var end = this.currentDOMChildIndex;
  this.morphs.push([morphNum, this.paths.slice(), start, end, true]);

  this.opcode('prepareObject', attrs.length);
  this.opcode('pushLiteral', component.tag);
  this.opcode('printComponentHook', this.templateId++, blockParams.length, meta(component));
};

HydrationOpcodeCompiler.prototype.attribute = function (attr) {
  var value = attr.value;
  var escaped = true;
  var namespace = _htmlbarsUtil.getAttrNamespace(attr.name);

  // TODO: Introduce context specific AST nodes to avoid switching here.
  if (value.type === 'TextNode') {
    return;
  } else if (value.type === 'MustacheStatement') {
    escaped = value.escaped;
    this.accept(_htmlbarsSyntaxUtils.unwrapMustache(value));
  } else if (value.type === 'ConcatStatement') {
    prepareParams(this, value.parts);
    this.opcode('pushConcatHook', this.morphNum);
  }

  this.opcode('pushLiteral', attr.name);

  var attrMorphNum = this.morphNum++;

  if (this.element !== null) {
    shareElement(this);
  }

  this.opcode('createAttrMorph', attrMorphNum, this.elementNum, attr.name, escaped, namespace);
  this.opcode('printAttributeHook');
};

HydrationOpcodeCompiler.prototype.elementModifier = function (modifier) {
  prepareHash(this, modifier.hash);
  prepareParams(this, modifier.params);
  preparePath(this, modifier.path);

  // If we have a helper in a node, and this element has not been cached, cache it
  if (this.element !== null) {
    shareElement(this);
  }

  publishElementMorph(this);
  this.opcode('printElementHook', meta(modifier));
};

HydrationOpcodeCompiler.prototype.pushMorphPlaceholderNode = function (childIndex, childCount, skipBoundaryNodes) {
  if (!skipBoundaryNodes) {
    if (this.paths.length === 0) {
      if (childIndex === 0) {
        this.opcode('openBoundary');
      }
      if (childIndex === childCount - 1) {
        this.opcode('closeBoundary');
      }
    }
  }

  this.comment();
};

HydrationOpcodeCompiler.prototype.MustacheStatement = function (mustache) {
  prepareHash(this, mustache.hash);
  prepareParams(this, mustache.params);
  preparePath(this, mustache.path);
  this.opcode('pushSexprHook', meta(mustache));
};

HydrationOpcodeCompiler.prototype.SubExpression = function (sexpr) {
  prepareHash(this, sexpr.hash);
  prepareParams(this, sexpr.params);
  preparePath(this, sexpr.path);
  this.opcode('pushSexprHook', meta(sexpr));
};

HydrationOpcodeCompiler.prototype.PathExpression = function (path) {
  this.opcode('pushGetHook', path.original, meta(path));
};

HydrationOpcodeCompiler.prototype.StringLiteral = function (node) {
  this.opcode('pushLiteral', node.value);
};

HydrationOpcodeCompiler.prototype.BooleanLiteral = function (node) {
  this.opcode('pushLiteral', node.value);
};

HydrationOpcodeCompiler.prototype.NumberLiteral = function (node) {
  this.opcode('pushLiteral', node.value);
};

HydrationOpcodeCompiler.prototype.UndefinedLiteral = function (node) {
  this.opcode('pushLiteral', node.value);
};

HydrationOpcodeCompiler.prototype.NullLiteral = function (node) {
  this.opcode('pushLiteral', node.value);
};

function preparePath(compiler, path) {
  compiler.opcode('pushLiteral', path.original);
}

function prepareParams(compiler, params) {
  for (var i = params.length - 1; i >= 0; i--) {
    var param = params[i];
    compiler[param.type](param);
  }

  compiler.opcode('prepareArray', params.length);
}

function prepareHash(compiler, hash) {
  var pairs = hash.pairs;

  for (var i = pairs.length - 1; i >= 0; i--) {
    var key = pairs[i].key;
    var value = pairs[i].value;

    compiler[value.type](value);
    compiler.opcode('pushLiteral', key);
  }

  compiler.opcode('prepareObject', pairs.length);
}

function shareElement(compiler) {
  compiler.opcode('shareElement', ++compiler.elementNum);
  compiler.element = null; // Set element to null so we don't cache it twice
}

function publishElementMorph(compiler) {
  var morphNum = compiler.morphNum++;
  compiler.opcode('createElementMorph', morphNum, compiler.elementNum);
}

function distributeMorphs(morphs, opcodes) {
  if (morphs.length === 0) {
    return;
  }

  // Splice morphs after the most recent shareParent/consumeParent.
  var o;
  for (o = opcodes.length - 1; o >= 0; --o) {
    var opcode = opcodes[o][0];
    if (opcode === 'shareElement' || opcode === 'consumeParent' || opcode === 'popParent') {
      break;
    }
  }

  var spliceArgs = [o + 1, 0];
  for (var i = 0; i < morphs.length; ++i) {
    spliceArgs.push(['createMorph', morphs[i].slice()]);
  }
  opcodes.splice.apply(opcodes, spliceArgs);
  morphs.length = 0;
}
module.exports = exports.default;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0bWxiYXJzLWNvbXBpbGVyL2h5ZHJhdGlvbi1vcGNvZGUtY29tcGlsZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OzsrQkFBNEIsb0JBQW9COzs7O3FCQUNqQixTQUFTOzs0QkFDUCxrQkFBa0I7O3NDQUMzQiw4QkFBOEI7O21DQUM3QiwwQkFBMEI7O0FBR25ELFNBQVMsc0JBQXNCLENBQUMsT0FBTyxFQUFDO0FBQ3RDLE9BQUssSUFBSSxDQUFDLEdBQUMsQ0FBQyxFQUFFLEdBQUcsR0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBQyxDQUFDLEdBQUMsR0FBRyxFQUFDLENBQUMsRUFBRSxFQUFFO0FBQ3JELFFBQUksT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUssU0FBUyxFQUFFO0FBQzVDLGFBQU8sSUFBSSxDQUFDO0tBQ2I7R0FDRjtBQUNELFNBQU8sS0FBSyxDQUFDO0NBQ2Q7O0FBRUQsU0FBUyx1QkFBdUIsR0FBRztBQUNqQyxNQUFJLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztBQUNsQixNQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztBQUNoQixNQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQztBQUNwQixNQUFJLENBQUMsb0JBQW9CLEdBQUcsQ0FBQyxDQUFDO0FBQzlCLE1BQUksQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDO0FBQ2pCLE1BQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDO0FBQ2xCLE1BQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO0FBQ3BCLE1BQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDLENBQUM7Q0FDdEI7O2tCQUVjLHVCQUF1Qjs7QUFFdEMsdUJBQXVCLENBQUMsU0FBUyxDQUFDLE9BQU8sR0FBRyxVQUFTLEdBQUcsRUFBRTtBQUN4RCxNQUFJLGVBQWUsR0FBRywrQkFBcUIsQ0FBQztBQUM1QyxpQkFBZSxDQUFDLEtBQUssQ0FBQyxHQUFHLENB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QUFDO0NBQ25CIiwiZmlsZSI6Imh0bWxiYXJzLWNvbXBpbGVyL2h5ZHJhdGlvbi1vcGNvZGUtY29tcGlsZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVGVtcGxhdGVWaXNpdG9yIGZyb20gXCIuL3RlbXBsYXRlLXZpc2l0b3JcIjtcbmltcG9ydCB7IHByb2Nlc3NPcGNvZGVzIH0gZnJvbSBcIi4vdXRpbHNcIjtcbmltcG9ydCB7IGdldEF0dHJOYW1lc3BhY2UgfSBmcm9tIFwiLi4vaHRtbGJhcnMtdXRpbFwiO1xuaW1wb3J0IHsgZm9yRWFjaCB9IGZyb20gXCIuLi9odG1sYmFycy11dGlsL2FycmF5LXV0aWxzXCI7XG5pbXBvcnQgeyBpc0hlbHBlciB9IGZyb20gXCIuLi9odG1sYmFycy1zeW50YXgvdXRpbHNcIjtcbmltcG9ydCB7IHVud3JhcE11c3RhY2hlIH0gZnJvbSBcIi4uL2h0bWxiYXJzLXN5bnRheC91dGlsc1wiO1xuXG5mdW5jdGlvbiBkZXRlY3RJc0VsZW1lbnRDaGVja2VkKGVsZW1lbnQpe1xuICBmb3IgKHZhciBpPTAsIGxlbj1lbGVtZW50LmF0dHJpYnV0ZXMubGVuZ3RoO2k8bGVuO2krKykge1xuICAgIGlmIChlbGVtZW50LmF0dHJpYnV0ZXNbaV0ubmFtZSA9PT0gJ2NoZWNrZWQnKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiBIeWRyYXRpb25PcGNvZGVDb21waWxlcigpIHtcbiAgdGhpcy5vcGNvZGVzID0gW107XG4gIHRoaXMucGF0aHMgPSBbXTtcbiAgdGhpcy50ZW1wbGF0ZUlkID0gMDtcbiAgdGhpcy5jdXJyZW50RE9NQ2hpbGRJbmRleCA9IDA7XG4gIHRoaXMubW9ycGhzID0gW107XG4gIHRoaXMubW9ycGhOdW0gPSAwO1xuICB0aGlzLmVsZW1lbnQgPSBudWxsO1xuICB0aGlzLmVsZW1lbnROdW0gPSAtMTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgSHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXI7XG5cbkh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyLnByb3RvdHlwZS5jb21waWxlID0gZnVuY3Rpb24oYXN0KSB7XG4gIHZhciB0ZW1wbGF0ZVZpc2l0b3IgPSBuZXcgVGVtcGxhdGVWaXNpdG9yKCk7XG4gIHRlbXBsYXRlVmlzaXRvci52aXNpdChhc3QpO1xuXG4gIHByb2Nlc3NPcGNvZGVzKHRoaXMsIHRlbXBsYXRlVmlzaXRvci5hY3Rpb25zKTtcblxuICByZXR1cm4gdGhpcy5vcGNvZGVzO1xufTtcblxuSHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIucHJvdG90eXBlLmFjY2VwdCA9IGZ1bmN0aW9uKG5vZGUpIHtcbiAgdGhpc1tub2RlLnR5cGVdKG5vZGUpO1xufTtcblxuSHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIucHJvdG90eXBlLm9wY29kZSA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgdmFyIHBhcmFtcyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTtcbiAgdGhpcy5vcGNvZGVzLnB1c2goW3R5cGUsIHBhcmFtc10pO1xufTtcblxuSHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIucHJvdG90eXBlLnN0YXJ0UHJvZ3JhbSA9IGZ1bmN0aW9uKHByb2dyYW0sIGMsIGJsYW5rQ2hpbGRUZXh0Tm9kZXMpIHtcbiAgdGhpcy5vcGNvZGVzLmxlbmd0aCA9IDA7XG4gIHRoaXMucGF0aHMubGVuZ3RoID0gMDtcbiAgdGhpcy5tb3JwaHMubGVuZ3RoID0gMDtcbiAgdGhpcy50ZW1wbGF0ZUlkID0gMDtcbiAgdGhpcy5jdXJyZW50RE9NQ2hpbGRJbmRleCA9IC0xO1xuICB0aGlzLm1vcnBoTnVtID0gMDtcblxuICB2YXIgYmxvY2tQYXJhbXMgPSBwcm9ncmFtLmJsb2NrUGFyYW1zIHx8IFtdO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgYmxvY2tQYXJhbXMubGVuZ3RoOyBpKyspIHtcbiAgICB0aGlzLm9wY29kZSgncHJpbnRTZXRIb29rJywgYmxvY2tQYXJhbXNbaV0sIGkpO1xuICB9XG5cbiAgaWYgKGJsYW5rQ2hpbGRUZXh0Tm9kZXMubGVuZ3RoID4gMCkge1xuICAgIHRoaXMub3Bjb2RlKCdyZXBhaXJDbG9uZWROb2RlJywgYmxhbmtDaGlsZFRleHROb2Rlcyk7XG4gIH1cbn07XG5cbkh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyLnByb3RvdHlwZS5pbnNlcnRCb3VuZGFyeSA9IGZ1bmN0aW9uKGZpcnN0KSB7XG4gIHRoaXMub3Bjb2RlKGZpcnN0ID8gJ29wZW5Cb3VuZGFyeScgOiAnY2xvc2VCb3VuZGFyeScpO1xufTtcblxuSHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIucHJvdG90eXBlLmVuZFByb2dyYW0gPSBmdW5jdGlvbigpIHtcbiAgZGlzdHJpYnV0ZU1vcnBocyh0aGlzLm1vcnBocywgdGhpcy5vcGNvZGVzKTtcbn07XG5cbkh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyLnByb3RvdHlwZS50ZXh0ID0gZnVuY3Rpb24oKSB7XG4gICsrdGhpcy5jdXJyZW50RE9NQ2hpbGRJbmRleDtcbn07XG5cbkh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyLnByb3RvdHlwZS5jb21tZW50ID0gZnVuY3Rpb24oKSB7XG4gICsrdGhpcy5jdXJyZW50RE9NQ2hpbGRJbmRleDtcbn07XG5cbkh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyLnByb3RvdHlwZS5vcGVuRWxlbWVudCA9IGZ1bmN0aW9uKGVsZW1lbnQsIHBvcywgbGVuLCBtdXN0YWNoZUNvdW50LCBibGFua0NoaWxkVGV4dE5vZGVzKSB7XG4gIGRpc3RyaWJ1dGVNb3JwaHModGhpcy5tb3JwaHMsIHRoaXMub3Bjb2Rlcyk7XG4gICsrdGhpcy5jdXJyZW50RE9NQ2hpbGRJbmRleDtcblxuICB0aGlzLmVsZW1lbnQgPSB0aGlzLmN1cnJlbnRET01DaGlsZEluZGV4O1xuXG4gIHRoaXMub3Bjb2RlKCdjb25zdW1lUGFyZW50JywgdGhpcy5jdXJyZW50RE9NQ2hpbGRJbmRleCk7XG5cbiAgLy8gSWYgb3VyIHBhcmVudCByZWZlcmVuY2Ugd2lsbCBiZSB1c2VkIG1vcmUgdGhhbiBvbmNlLCBjYWNoZSBpdHMgcmVmZXJlbmNlLlxuICBpZiAobXVzdGFjaGVDb3VudCA+IDEpIHtcbiAgICBzaGFyZUVsZW1lbnQodGhpcyk7XG4gIH1cblxuICB2YXIgaXNFbGVtZW50Q2hlY2tlZCA9IGRldGVjdElzRWxlbWVudENoZWNrZWQoZWxlbWVudCk7XG4gIGlmIChibGFua0NoaWxkVGV4dE5vZGVzLmxlbmd0aCA+IDAgfHwgaXNFbGVtZW50Q2hlY2tlZCkge1xuICAgIHRoaXMub3Bjb2RlKCAncmVwYWlyQ2xvbmVkTm9kZScsXG4gICAgICAgICAgICAgICAgIGJsYW5rQ2hpbGRUZXh0Tm9kZXMsXG4gICAgICAgICAgICAgICAgIGlzRWxlbWVudENoZWNrZWQgKTtcbiAgfVxuXG4gIHRoaXMucGF0aHMucHVzaCh0aGlzLmN1cnJlbnRET01DaGlsZEluZGV4KTtcbiAgdGhpcy5jdXJyZW50RE9NQ2hpbGRJbmRleCA9IC0xO1xuXG4gIGZvckVhY2goZWxlbWVudC5hdHRyaWJ1dGVzLCB0aGlzLmF0dHJpYnV0ZSwgdGhpcyk7XG4gIGZvckVhY2goZWxlbWVudC5tb2RpZmllcnMsIHRoaXMuZWxlbWVudE1vZGlmaWVyLCB0aGlzKTtcbn07XG5cbkh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyLnByb3RvdHlwZS5jbG9zZUVsZW1lbnQgPSBmdW5jdGlvbigpIHtcbiAgZGlzdHJpYnV0ZU1vcnBocyh0aGlzLm1vcnBocywgdGhpcy5vcGNvZGVzKTtcbiAgdGhpcy5vcGNvZGUoJ3BvcFBhcmVudCcpO1xuICB0aGlzLmN1cnJlbnRET01DaGlsZEluZGV4ID0gdGhpcy5wYXRocy5wb3AoKTtcbn07XG5cbkh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyLnByb3RvdHlwZS5tdXN0YWNoZSA9IGZ1bmN0aW9uKG11c3RhY2hlLCBjaGlsZEluZGV4LCBjaGlsZENvdW50KSB7XG4gIHRoaXMucHVzaE1vcnBoUGxhY2Vob2xkZXJOb2RlKGNoaWxkSW5kZXgsIGNoaWxkQ291bnQpO1xuXG4gIHZhciBvcGNvZGU7XG5cbiAgaWYgKGlzSGVscGVyKG11c3RhY2hlKSkge1xuICAgIHByZXBhcmVIYXNoKHRoaXMsIG11c3RhY2hlLmhhc2gpO1xuICAgIHByZXBhcmVQYXJhbXModGhpcywgbXVzdGFjaGUucGFyYW1zKTtcbiAgICBwcmVwYXJlUGF0aCh0aGlzLCBtdXN0YWNoZS5wYXRoKTtcbiAgICBvcGNvZGUgPSAncHJpbnRJbmxpbmVIb29rJztcbiAgfSBlbHNlIHtcbiAgICBwcmVwYXJlUGF0aCh0aGlzLCBtdXN0YWNoZS5wYXRoKTtcbiAgICBvcGNvZGUgPSAncHJpbnRDb250ZW50SG9vayc7XG4gIH1cblxuICB2YXIgbW9ycGhOdW0gPSB0aGlzLm1vcnBoTnVtKys7XG4gIHZhciBzdGFydCA9IHRoaXMuY3VycmVudERPTUNoaWxkSW5kZXg7XG4gIHZhciBlbmQgPSB0aGlzLmN1cnJlbnRET01DaGlsZEluZGV4O1xuICB0aGlzLm1vcnBocy5wdXNoKFttb3JwaE51bSwgdGhpcy5wYXRocy5zbGljZSgpLCBzdGFydCwgZW5kLCBtdXN0YWNoZS5lc2NhcGVkXSk7XG5cbiAgdGhpcy5vcGNvZGUob3Bjb2RlLCBtZXRhKG11c3RhY2hlKSk7XG59O1xuXG5mdW5jdGlvbiBtZXRhKG5vZGUpIHtcbiAgbGV0IGxvYyA9IG5vZGUubG9jO1xuICBpZiAoIWxvYykgeyByZXR1cm4gW107IH1cblxuICBsZXQgeyBzb3VyY2UsIHN0YXJ0LCBlbmQgfSA9IGxvYztcbiAgcmV0dXJuIFsgJ2xvYycsIFtzb3VyY2UgfHwgbnVsbCwgW3N0YXJ0LmxpbmUsIHN0YXJ0LmNvbHVtbl0sIFtlbmQubGluZSwgZW5kLmNvbHVtbl1dIF07XG59XG5cbkh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyLnByb3RvdHlwZS5ibG9jayA9IGZ1bmN0aW9uKGJsb2NrLCBjaGlsZEluZGV4LCBjaGlsZENvdW50KSB7XG4gIHRoaXMucHVzaE1vcnBoUGxhY2Vob2xkZXJOb2RlKGNoaWxkSW5kZXgsIGNoaWxkQ291bnQpO1xuXG4gIHByZXBhcmVIYXNoKHRoaXMsIGJsb2NrLmhhc2gpO1xuICBwcmVwYXJlUGFyYW1zKHRoaXMsIGJsb2NrLnBhcmFtcyk7XG4gIHByZXBhcmVQYXRoKHRoaXMsIGJsb2NrLnBhdGgpO1xuXG4gIHZhciBtb3JwaE51bSA9IHRoaXMubW9ycGhOdW0rKztcbiAgdmFyIHN0YXJ0ID0gdGhpcy5jdXJyZW50RE9NQ2hpbGRJbmRleDtcbiAgdmFyIGVuZCA9IHRoaXMuY3VycmVudERPTUNoaWxkSW5kZXg7XG4gIHRoaXMubW9ycGhzLnB1c2goW21vcnBoTnVtLCB0aGlzLnBhdGhzLnNsaWNlKCksIHN0YXJ0LCBlbmQsIHRydWVdKTtcblxuICB2YXIgdGVtcGxhdGVJZCA9IHRoaXMudGVtcGxhdGVJZCsrO1xuICB2YXIgaW52ZXJzZUlkID0gYmxvY2suaW52ZXJzZSA9PT0gbnVsbCA/IG51bGwgOiB0aGlzLnRlbXBsYXRlSWQrKztcblxuICB0aGlzLm9wY29kZSgncHJpbnRCbG9ja0hvb2snLCB0ZW1wbGF0ZUlkLCBpbnZlcnNlSWQsIG1ldGEoYmxvY2spKTtcbn07XG5cbkh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyLnByb3RvdHlwZS5jb21wb25lbnQgPSBmdW5jdGlvbihjb21wb25lbnQsIGNoaWxkSW5kZXgsIGNoaWxkQ291bnQpIHtcbiAgdGhpcy5wdXNoTW9ycGhQbGFjZWhvbGRlck5vZGUoY2hpbGRJbmRleCwgY2hpbGRDb3VudCwgY29tcG9uZW50LmlzU3RhdGljKTtcblxuICB2YXIgcHJvZ3JhbSA9IGNvbXBvbmVudC5wcm9ncmFtIHx8IHt9O1xuICB2YXIgYmxvY2tQYXJhbXMgPSBwcm9ncmFtLmJsb2NrUGFyYW1zIHx8IFtdO1xuXG4gIHZhciBhdHRycyA9IGNvbXBvbmVudC5hdHRyaWJ1dGVzO1xuICBmb3IgKHZhciBpID0gYXR0cnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICB2YXIgbmFtZSA9IGF0dHJzW2ldLm5hbWU7XG4gICAgdmFyIHZhbHVlID0gYXR0cnNbaV0udmFsdWU7XG5cbiAgICAvLyBUT0RPOiBJbnRyb2R1Y2UgY29udGV4dCBzcGVjaWZpYyBBU1Qgbm9kZXMgdG8gYXZvaWQgc3dpdGNoaW5nIGhlcmUuXG4gICAgaWYgKHZhbHVlLnR5cGUgPT09ICdUZXh0Tm9kZScpIHtcbiAgICAgIHRoaXMub3Bjb2RlKCdwdXNoTGl0ZXJhbCcsIHZhbHVlLmNoYXJzKTtcbiAgICB9IGVsc2UgaWYgKHZhbHVlLnR5cGUgPT09ICdNdXN0YWNoZVN0YXRlbWVudCcpIHtcbiAgICAgIHRoaXMuYWNjZXB0KHVud3JhcE11c3RhY2hlKHZhbHVlKSk7XG4gICAgfSBlbHNlIGlmICh2YWx1ZS50eXBlID09PSAnQ29uY2F0U3RhdGVtZW50Jykge1xuICAgICAgcHJlcGFyZVBhcmFtcyh0aGlzLCB2YWx1ZS5wYXJ0cyk7XG4gICAgICB0aGlzLm9wY29kZSgncHVzaENvbmNhdEhvb2snLCB0aGlzLm1vcnBoTnVtKTtcbiAgICB9XG5cbiAgICB0aGlzLm9wY29kZSgncHVzaExpdGVyYWwnLCBuYW1lKTtcbiAgfVxuXG4gIHZhciBtb3JwaE51bSA9IHRoaXMubW9ycGhOdW0rKztcbiAgdmFyIHN0YXJ0ID0gdGhpcy5jdXJyZW50RE9NQ2hpbGRJbmRleDtcbiAgdmFyIGVuZCA9IHRoaXMuY3VycmVudERPTUNoaWxkSW5kZXg7XG4gIHRoaXMubW9ycGhzLnB1c2goW21vcnBoTnVtLCB0aGlzLnBhdGhzLnNsaWNlKCksIHN0YXJ0LCBlbmQsIHRydWVdKTtcblxuICB0aGlzLm9wY29kZSgncHJlcGFyZU9iamVjdCcsIGF0dHJzLmxlbmd0aCk7XG4gIHRoaXMub3Bjb2RlKCdwdXNoTGl0ZXJhbCcsIGNvbXBvbmVudC50YWcpO1xuICB0aGlzLm9wY29kZSgncHJpbnRDb21wb25lbnRIb29rJywgdGhpcy50ZW1wbGF0ZUlkKyssIGJsb2NrUGFyYW1zLmxlbmd0aCwgbWV0YShjb21wb25lbnQpKTtcbn07XG5cbkh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyLnByb3RvdHlwZS5hdHRyaWJ1dGUgPSBmdW5jdGlvbihhdHRyKSB7XG4gIHZhciB2YWx1ZSA9IGF0dHIudmFsdWU7XG4gIHZhciBlc2NhcGVkID0gdHJ1ZTtcbiAgdmFyIG5hbWVzcGFjZSA9IGdldEF0dHJOYW1lc3BhY2UoYXR0ci5uYW1lKTtcblxuICAvLyBUT0RPOiBJbnRyb2R1Y2UgY29udGV4dCBzcGVjaWZpYyBBU1Qgbm9kZXMgdG8gYXZvaWQgc3dpdGNoaW5nIGhlcmUuXG4gIGlmICh2YWx1ZS50eXBlID09PSAnVGV4dE5vZGUnKSB7XG4gICAgcmV0dXJuO1xuICB9IGVsc2UgaWYgKHZhbHVlLnR5cGUgPT09ICdNdXN0YWNoZVN0YXRlbWVudCcpIHtcbiAgICBlc2NhcGVkID0gdmFsdWUuZXNjYXBlZDtcbiAgICB0aGlzLmFjY2VwdCh1bndyYXBNdXN0YWNoZSh2YWx1ZSkpO1xuICB9IGVsc2UgaWYgKHZhbHVlLnR5cGUgPT09ICdDb25jYXRTdGF0ZW1lbnQnKSB7XG4gICAgcHJlcGFyZVBhcmFtcyh0aGlzLCB2YWx1ZS5wYXJ0cyk7XG4gICAgdGhpcy5vcGNvZGUoJ3B1c2hDb25jYXRIb29rJywgdGhpcy5tb3JwaE51bSk7XG4gIH1cblxuICB0aGlzLm9wY29kZSgncHVzaExpdGVyYWwnLCBhdHRyLm5hbWUpO1xuXG4gIHZhciBhdHRyTW9ycGhOdW0gPSB0aGlzLm1vcnBoTnVtKys7XG5cbiAgaWYgKHRoaXMuZWxlbWVudCAhPT0gbnVsbCkge1xuICAgIHNoYXJlRWxlbWVudCh0aGlzKTtcbiAgfVxuXG4gIHRoaXMub3Bjb2RlKCdjcmVhdGVBdHRyTW9ycGgnLCBhdHRyTW9ycGhOdW0sIHRoaXMuZWxlbWVudE51bSwgYXR0ci5uYW1lLCBlc2NhcGVkLCBuYW1lc3BhY2UpO1xuICB0aGlzLm9wY29kZSgncHJpbnRBdHRyaWJ1dGVIb29rJyk7XG59O1xuXG5IeWRyYXRpb25PcGNvZGVDb21waWxlci5wcm90b3R5cGUuZWxlbWVudE1vZGlmaWVyID0gZnVuY3Rpb24obW9kaWZpZXIpIHtcbiAgcHJlcGFyZUhhc2godGhpcywgbW9kaWZpZXIuaGFzaCk7XG4gIHByZXBhcmVQYXJhbXModGhpcywgbW9kaWZpZXIucGFyYW1zKTtcbiAgcHJlcGFyZVBhdGgodGhpcywgbW9kaWZpZXIucGF0aCk7XG5cbiAgLy8gSWYgd2UgaGF2ZSBhIGhlbHBlciBpbiBhIG5vZGUsIGFuZCB0aGlzIGVsZW1lbnQgaGFzIG5vdCBiZWVuIGNhY2hlZCwgY2FjaGUgaXRcbiAgaWYgKHRoaXMuZWxlbWVudCAhPT0gbnVsbCkge1xuICAgIHNoYXJlRWxlbWVudCh0aGlzKTtcbiAgfVxuXG4gIHB1Ymxpc2hFbGVtZW50TW9ycGgodGhpcyk7XG4gIHRoaXMub3Bjb2RlKCdwcmludEVsZW1lbnRIb29rJywgbWV0YShtb2RpZmllcikpO1xufTtcblxuSHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIucHJvdG90eXBlLnB1c2hNb3JwaFBsYWNlaG9sZGVyTm9kZSA9IGZ1bmN0aW9uKGNoaWxkSW5kZXgsIGNoaWxkQ291bnQsIHNraXBCb3VuZGFyeU5vZGVzKSB7XG4gIGlmICghc2tpcEJvdW5kYXJ5Tm9kZXMpIHtcbiAgICBpZiAodGhpcy5wYXRocy5sZW5ndGggPT09IDApIHtcbiAgICAgIGlmIChjaGlsZEluZGV4ID09PSAwKSB7XG4gICAgICAgIHRoaXMub3Bjb2RlKCdvcGVuQm91bmRhcnknKTtcbiAgICAgIH1cbiAgICAgIGlmIChjaGlsZEluZGV4ID09PSBjaGlsZENvdW50IC0gMSkge1xuICAgICAgICB0aGlzLm9wY29kZSgnY2xvc2VCb3VuZGFyeScpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHRoaXMuY29tbWVudCgpO1xufTtcblxuSHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIucHJvdG90eXBlLk11c3RhY2hlU3RhdGVtZW50ID0gZnVuY3Rpb24obXVzdGFjaGUpIHtcbiAgcHJlcGFyZUhhc2godGhpcywgbXVzdGFjaGUuaGFzaCk7XG4gIHByZXBhcmVQYXJhbXModGhpcywgbXVzdGFjaGUucGFyYW1zKTtcbiAgcHJlcGFyZVBhdGgodGhpcywgbXVzdGFjaGUucGF0aCk7XG4gIHRoaXMub3Bjb2RlKCdwdXNoU2V4cHJIb29rJywgbWV0YShtdXN0YWNoZSkpO1xufTtcblxuSHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIucHJvdG90eXBlLlN1YkV4cHJlc3Npb24gPSBmdW5jdGlvbihzZXhwcikge1xuICBwcmVwYXJlSGFzaCh0aGlzLCBzZXhwci5oYXNoKTtcbiAgcHJlcGFyZVBhcmFtcyh0aGlzLCBzZXhwci5wYXJhbXMpO1xuICBwcmVwYXJlUGF0aCh0aGlzLCBzZXhwci5wYXRoKTtcbiAgdGhpcy5vcGNvZGUoJ3B1c2hTZXhwckhvb2snLCBtZXRhKHNleHByKSk7XG59O1xuXG5IeWRyYXRpb25PcGNvZGVDb21waWxlci5wcm90b3R5cGUuUGF0aEV4cHJlc3Npb24gPSBmdW5jdGlvbihwYXRoKSB7XG4gIHRoaXMub3Bjb2RlKCdwdXNoR2V0SG9vaycsIHBhdGgub3JpZ2luYWwsIG1ldGEocGF0aCkpO1xufTtcblxuSHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIucHJvdG90eXBlLlN0cmluZ0xpdGVyYWwgPSBmdW5jdGlvbihub2RlKSB7XG4gIHRoaXMub3Bjb2RlKCdwdXNoTGl0ZXJhbCcsIG5vZGUudmFsdWUpO1xufTtcblxuSHlkcmF0aW9uT3Bjb2RlQ29tcGlsZXIucHJvdG90eXBlLkJvb2xlYW5MaXRlcmFsID0gZnVuY3Rpb24obm9kZSkge1xuICB0aGlzLm9wY29kZSgncHVzaExpdGVyYWwnLCBub2RlLnZhbHVlKTtcbn07XG5cbkh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyLnByb3RvdHlwZS5OdW1iZXJMaXRlcmFsID0gZnVuY3Rpb24obm9kZSkge1xuICB0aGlzLm9wY29kZSgncHVzaExpdGVyYWwnLCBub2RlLnZhbHVlKTtcbn07XG5cbkh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyLnByb3RvdHlwZS5VbmRlZmluZWRMaXRlcmFsID0gZnVuY3Rpb24obm9kZSkge1xuICB0aGlzLm9wY29kZSgncHVzaExpdGVyYWwnLCBub2RlLnZhbHVlKTtcbn07XG5cbkh5ZHJhdGlvbk9wY29kZUNvbXBpbGVyLnByb3RvdHlwZS5OdWxsTGl0ZXJhbCA9IGZ1bmN0aW9uKG5vZGUpIHtcbiAgdGhpcy5vcGNvZGUoJ3B1c2hMaXRlcmFsJywgbm9kZS52YWx1ZSk7XG59O1xuXG5mdW5jdGlvbiBwcmVwYXJlUGF0aChjb21waWxlciwgcGF0aCkge1xuICBjb21waWxlci5vcGNvZGUoJ3B1c2hMaXRlcmFsJywgcGF0aC5vcmlnaW5hbCk7XG59XG5cbmZ1bmN0aW9uIHByZXBhcmVQYXJhbXMoY29tcGlsZXIsIHBhcmFtcykge1xuICBmb3IgKHZhciBpID0gcGFyYW1zLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgdmFyIHBhcmFtID0gcGFyYW1zW2ldO1xuICAgIGNvbXBpbGVyW3BhcmFtLnR5cGVdKHBhcmFtKTtcbiAgfVxuXG4gIGNvbXBpbGVyLm9wY29kZSgncHJlcGFyZUFycmF5JywgcGFyYW1zLmxlbmd0aCk7XG59XG5cbmZ1bmN0aW9uIHByZXBhcmVIYXNoKGNvbXBpbGVyLCBoYXNoKSB7XG4gIHZhciBwYWlycyA9IGhhc2gucGFpcnM7XG5cbiAgZm9yICh2YXIgaSA9IHBhaXJzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgdmFyIGtleSA9IHBhaXJzW2ldLmtleTtcbiAgICB2YXIgdmFsdWUgPSBwYWlyc1tpXS52YWx1ZTtcblxuICAgIGNvbXBpbGVyW3ZhbHVlLnR5cGVdKHZhbHVlKTtcbiAgICBjb21waWxlci5vcGNvZGUoJ3B1c2hMaXRlcmFsJywga2V5KTtcbiAgfVxuXG4gIGNvbXBpbGVyLm9wY29kZSgncHJlcGFyZU9iamVjdCcsIHBhaXJzLmxlbmd0aCk7XG59XG5cbmZ1bmN0aW9uIHNoYXJlRWxlbWVudChjb21waWxlcikge1xuICBjb21waWxlci5vcGNvZGUoJ3NoYXJlRWxlbWVudCcsICsrY29tcGlsZXIuZWxlbWVudE51bSk7XG4gIGNvbXBpbGVyLmVsZW1lbnQgPSBudWxsOyAvLyBTZXQgZWxlbWVudCB0byBudWxsIHNvIHdlIGRvbid0IGNhY2hlIGl0IHR3aWNlXG59XG5cbmZ1bmN0aW9uIHB1Ymxpc2hFbGVtZW50TW9ycGgoY29tcGlsZXIpIHtcbiAgdmFyIG1vcnBoTnVtID0gY29tcGlsZXIubW9ycGhOdW0rKztcbiAgY29tcGlsZXIub3Bjb2RlKCdjcmVhdGVFbGVtZW50TW9ycGgnLCBtb3JwaE51bSwgY29tcGlsZXIuZWxlbWVudE51bSk7XG59XG5cbmZ1bmN0aW9uIGRpc3RyaWJ1dGVNb3JwaHMobW9ycGhzLCBvcGNvZGVzKSB7XG4gIGlmIChtb3JwaHMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gU3BsaWNlIG1vcnBocyBhZnRlciB0aGUgbW9zdCByZWNlbnQgc2hhcmVQYXJlbnQvY29uc3VtZVBhcmVudC5cbiAgdmFyIG87XG4gIGZvciAobyA9IG9wY29kZXMubGVuZ3RoIC0gMTsgbyA+PSAwOyAtLW8pIHtcbiAgICB2YXIgb3Bjb2RlID0gb3Bjb2Rlc1tvXVswXTtcbiAgICBpZiAob3Bjb2RlID09PSAnc2hhcmVFbGVtZW50JyB8fCBvcGNvZGUgPT09ICdjb25zdW1lUGFyZW50JyAgfHwgb3Bjb2RlID09PSAncG9wUGFyZW50Jykge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgdmFyIHNwbGljZUFyZ3MgPSBbbyArIDEsIDBdO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IG1vcnBocy5sZW5ndGg7ICsraSkge1xuICAgIHNwbGljZUFyZ3MucHVzaChbJ2NyZWF0ZU1vcnBoJywgbW9ycGhzW2ldLnNsaWNlKCldKTtcbiAgfVxuICBvcGNvZGVzLnNwbGljZS5hcHBseShvcGNvZGVzLCBzcGxpY2VBcmdzKTtcbiAgbW9ycGhzLmxlbmd0aCA9IDA7XG59XG4iXX0=