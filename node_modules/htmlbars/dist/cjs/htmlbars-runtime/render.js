exports.__esModule = true;
exports.default = render;
exports.RenderOptions = RenderOptions;
exports.manualElement = manualElement;
exports.attachAttributes = attachAttributes;
exports.createChildMorph = createChildMorph;
exports.getCachedFragment = getCachedFragment;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var _htmlbarsUtilMorphUtils = require("../htmlbars-util/morph-utils");

var _nodeVisitor = require("./node-visitor");

var _nodeVisitor2 = _interopRequireDefault(_nodeVisitor);

var _morph = require("./morph");

var _morph2 = _interopRequireDefault(_morph);

var _htmlbarsUtilTemplateUtils = require("../htmlbars-util/template-utils");

var _htmlbarsUtilVoidTagNames = require('../htmlbars-util/void-tag-names');

var _htmlbarsUtilVoidTagNames2 = _interopRequireDefault(_htmlbarsUtilVoidTagNames);

var svgNamespace = "http://www.w3.org/2000/svg";

function render(template, env, scope, options) {
  var dom = env.dom;
  var contextualElement;

  if (options) {
    if (options.renderNode) {
      contextualElement = options.renderNode.contextualElement;
    } else if (options.contextualElement) {
      contextualElement = options.contextualElement;
    }
  }

  dom.detectNamespace(contextualElement);

  var renderResult = RenderResult.build(env, scope, template, options, contextualElement);
  renderResult.render();

  return renderResult;
}

function RenderOptions(renderNode, self, blockArguments, contextualElement) {
  this.renderNode = renderNode || null;
  this.self = self;
  this.blockArguments = blockArguments || null;
  this.contextualElement = contextualElement || null;
}

function RenderResult(env, scope, options, rootNode, ownerNode, nodes, fragment, template, shouldSetContent) {
  this.root = rootNode;
  this.fragment = fragment;

  this.nodes = nodes;
  this.template = template;
  this.statements = template.statements.slice();
  this.env = env;
  this.scope = scope;
  this.shouldSetContent = shouldSetContent;

  if (options.self !== undefined) {
    this.bindSelf(options.self);
  }
  if (options.blockArguments !== undefined) {
    this.bindLocals(options.blockArguments);
  }

  this.initializeNodes(ownerNode);
}

RenderResult.build = function (env, scope, template, options, contextualElement) {
  var dom = env.dom;
  var fragment = getCachedFragment(template, env);
  var nodes = template.buildRenderNodes(dom, fragment, contextualElement);

  var rootNode, ownerNode, shouldSetContent;

  if (options && options.renderNode) {
    rootNode = options.renderNode;
    ownerNode = rootNode.ownerNode;
    shouldSetContent = true;
  } else {
    rootNode = dom.createMorph(null, fragment.firstChild, fragment.lastChild, contextualElement);
    ownerNode = rootNode;
    rootNode.ownerNode = ownerNode;
    shouldSetContent = false;
  }

  if (rootNode.childNodes) {
    _htmlbarsUtilMorphUtils.visitChildren(rootNode.childNodes, function (node) {
      _htmlbarsUtilTemplateUtils.clearMorph(node, env, true);
    });
  }

  rootNode.childNodes = nodes;
  return new RenderResult(env, scope, options, rootNode, ownerNode, nodes, fragment, template, shouldSetContent);
};

function manualElement(tagName, attributes, _isEmpty) {
  var statements = [];

  for (var key in attributes) {
    if (typeof attributes[key] === 'string') {
      continue;
    }
    statements.push(["attribute", key, attributes[key]]);
  }

  var isEmpty = _isEmpty || _htmlbarsUtilVoidTagNames2.default[tagName];

  if (!isEmpty) {
    statements.push(['content', 'yield']);
  }

  var template = {
    arity: 0,
    cachedFragment: null,
    hasRendered: false,
    buildFragment: function buildFragment(dom) {
      var el0 = dom.createDocumentFragment();
      if (tagName === 'svg') {
        dom.setNamespace(svgNamespace);
      }
      var el1 = dom.createElement(tagName);

      for (var key in attributes) {
        if (typeof attributes[key] !== 'string') {
          continue;
        }
        dom.setAttribute(el1, key, attributes[key]);
      }

      if (!isEmpty) {
        var el2 = dom.createComment("");
        dom.appendChild(el1, el2);
      }

      dom.appendChild(el0, el1);

      return el0;
    },
    buildRenderNodes: function buildRenderNodes(dom, fragment) {
      var element = dom.childAt(fragment, [0]);
      var morphs = [];

      for (var key in attributes) {
        if (typeof attributes[key] === 'string') {
          continue;
        }
        morphs.push(dom.createAttrMorph(element, key));
      }

      if (!isEmpty) {
        morphs.push(dom.createMorphAt(element, 0, 0));
      }

      return morphs;
    },
    statements: statements,
    locals: [],
    templates: []
  };

  return template;
}

function attachAttributes(attributes) {
  var statements = [];

  for (var key in attributes) {
    if (typeof attributes[key] === 'string') {
      continue;
    }
    statements.push(["attribute", key, attributes[key]]);
  }

  var template = {
    arity: 0,
    cachedFragment: null,
    hasRendered: false,
    buildFragment: function buildFragment(dom) {
      var el0 = this.element;
      if (el0.namespaceURI === "http://www.w3.org/2000/svg") {
        dom.setNamespace(svgNamespace);
      }
      for (var key in attributes) {
        if (typeof attributes[key] !== 'string') {
          continue;
        }
        dom.setAttribute(el0, key, attributes[key]);
      }

      return el0;
    },
    buildRenderNodes: function buildRenderNodes(dom) {
      var element = this.element;
      var morphs = [];

      for (var key in attributes) {
        if (typeof attributes[key] === 'string') {
          continue;
        }
        morphs.push(dom.createAttrMorph(element, key));
      }

      return morphs;
    },
    statements: statements,
    locals: [],
    templates: [],
    element: null
  };

  return template;
}

RenderResult.prototype.initializeNodes = function (ownerNode) {
  var childNodes = this.root.childNodes;

  for (var i = 0, l = childNodes.length; i < l; i++) {
    childNodes[i].ownerNode = ownerNode;
  }
};

RenderResult.prototype.render = function () {
  this.root.lastResult = this;
  this.root.rendered = true;
  this.populateNodes(_nodeVisitor.AlwaysDirtyVisitor);

  if (this.shouldSetContent && this.root.setContent) {
    this.root.setContent(this.fragment);
  }
};

RenderResult.prototype.dirty = function () {
  _htmlbarsUtilMorphUtils.visitChildren([this.root], function (node) {
    node.isDirty = true;
  });
};

RenderResult.prototype.revalidate = function (env, self, blockArguments, scope) {
  this.revalidateWith(env, scope, self, blockArguments, _nodeVisitor2.default);
};

RenderResult.prototype.rerender = function (env, self, blockArguments, scope) {
  this.revalidateWith(env, scope, self, blockArguments, _nodeVisitor.AlwaysDirtyVisitor);
};

RenderResult.prototype.revalidateWith = function (env, scope, self, blockArguments, visitor) {
  if (env !== undefined) {
    this.env = env;
  }
  if (scope !== undefined) {
    this.scope = scope;
  }
  this.updateScope();

  if (self !== undefined) {
    this.updateSelf(self);
  }
  if (blockArguments !== undefined) {
    this.updateLocals(blockArguments);
  }

  this.populateNodes(visitor);
};

RenderResult.prototype.destroy = function () {
  var rootNode = this.root;
  _htmlbarsUtilTemplateUtils.clearMorph(rootNode, this.env, true);
};

RenderResult.prototype.populateNodes = function (visitor) {
  var env = this.env;
  var scope = this.scope;
  var template = this.template;
  var nodes = this.nodes;
  var statements = this.statements;
  var i, l;

  for (i = 0, l = statements.length; i < l; i++) {
    var statement = statements[i];
    var morph = nodes[i];

    if (env.hooks.willRenderNode) {
      env.hooks.willRenderNode(morph, env, scope);
    }

    switch (statement[0]) {
      case 'block':
        visitor.block(statement, morph, env, scope, template, visitor);break;
      case 'inline':
        visitor.inline(statement, morph, env, scope, visitor);break;
      case 'content':
        visitor.content(statement, morph, env, scope, visitor);break;
      case 'element':
        visitor.element(statement, morph, env, scope, template, visitor);break;
      case 'attribute':
        visitor.attribute(statement, morph, env, scope);break;
      case 'component':
        visitor.component(statement, morph, env, scope, template, visitor);break;
    }

    if (env.hooks.didRenderNode) {
      env.hooks.didRenderNode(morph, env, scope);
    }
  }
};

RenderResult.prototype.bindScope = function () {
  this.env.hooks.bindScope(this.env, this.scope);
};

RenderResult.prototype.updateScope = function () {
  this.env.hooks.updateScope(this.env, this.scope);
};

RenderResult.prototype.bindSelf = function (self) {
  this.env.hooks.bindSelf(this.env, this.scope, self);
};

RenderResult.prototype.updateSelf = function (self) {
  this.env.hooks.updateSelf(this.env, this.scope, self);
};

RenderResult.prototype.bindLocals = function (blockArguments) {
  var localNames = this.template.locals;

  for (var i = 0, l = localNames.length; i < l; i++) {
    this.env.hooks.bindLocal(this.env, this.scope, localNames[i], blockArguments[i]);
  }
};

RenderResult.prototype.updateLocals = function (blockArguments) {
  var localNames = this.template.locals;

  for (var i = 0, l = localNames.length; i < l; i++) {
    this.env.hooks.updateLocal(this.env, this.scope, localNames[i], blockArguments[i]);
  }
};

function initializeNode(node, owner) {
  node.ownerNode = owner;
}

function createChildMorph(dom, parentMorph, contextualElement) {
  var morph = _morph2.default.empty(dom, contextualElement || parentMorph.contextualElement);
  initializeNode(morph, parentMorph.ownerNode);
  return morph;
}

function getCachedFragment(template, env) {
  var dom = env.dom,
      fragment;
  if (env.useFragmentCache && dom.canClone) {
    if (template.cachedFragment === null) {
      fragment = template.buildFragment(dom);
      if (template.hasRendered) {
        template.cachedFragment = fragment;
      } else {
        template.hasRendered = true;
      }
    }
    if (template.cachedFragment) {
      fragment = dom.cloneNode(template.cachedFragment, true);
    }
  } else if (!fragment) {
    fragment = template.buildFragment(dom);
  }

  return fragment;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0bWxiYXJzLXJ1bnRpbWUvcmVuZGVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7a0JBU3dCLE1BQU07Ozs7Ozs7OztzQ0FUQSw4QkFBOEI7OzJCQUM5QixnQkFBZ0I7Ozs7cUJBRTVCLFNBQVM7Ozs7eUNBQ0EsaUNBQWlDOzt3Q0FDeEMsaUNBQWlDOzs7O0FBRXJELElBQUksWUFBWSxHQUFHLDRCQUE0QixDQUFDOztBQUVqQyxTQUFTLE1BQU0sQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUU7QUFDNUQsTUFBSSxHQUFHLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQztBQUNsQixNQUFJLGlCQUFpQixDQUFDOztBQUV0QixNQUFJLE9BQU8sRUFBRTtBQUNYLFFBQUksT0FBTyxDQUFDLFVBQVUsRUFBRTtBQUN0Qix1QkFBaUIsR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDLGlCQUFpQixDQUFDO0tBQzFELE1BQU0sSUFBSSxPQUFPLENBQUMsaUJBQWlCLEVBQUU7QUFDcEMsdUJBQWlCLEdBQUcsT0FBTyxDQUFDLGlCQUFpQixDQUFDO0tBQy9DO0dBQ0Y7O0FBRUQsS0FBRyxDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDOztBQUV2QyxNQUFJLFlBQVksR0FBRyxZQUFZLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO0FBQ3hGLGNBQVksQ0FBQyxNQUFNLEVBQUUsQ0FBQzs7QUFFdEIsU0FBTyxZQUFZLENBQUM7Q0FDckI7O0FBRU0sU0FBUyxhQUFhLENBQUMsVUFBVSxFQUFFLElBQUksRUFBRSxjQUFjLEVBQUUsaUJBQWlCLEVBQUU7QUFDakYsTUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLElBQUksSUFBSSxDQUFDO0FBQ3JDLE1BQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0FBQ2pCLE1BQUksQ0FBQyxjQUFjLEdBQUcsY0FB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USxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQztHQUN4Qzs7QUFFRCxTQUFPLFFBQVEsQ0FBQztDQUNqQiIsImZpbGUiOiJodG1sYmFycy1ydW50aW1lL3JlbmRlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHZpc2l0Q2hpbGRyZW4gfSBmcm9tIFwiLi4vaHRtbGJhcnMtdXRpbC9tb3JwaC11dGlsc1wiO1xuaW1wb3J0IEV4cHJlc3Npb25WaXNpdG9yIGZyb20gXCIuL25vZGUtdmlzaXRvclwiO1xuaW1wb3J0IHsgQWx3YXlzRGlydHlWaXNpdG9yIH0gZnJvbSBcIi4vbm9kZS12aXNpdG9yXCI7XG5pbXBvcnQgTW9ycGggZnJvbSBcIi4vbW9ycGhcIjtcbmltcG9ydCB7IGNsZWFyTW9ycGggfSBmcm9tIFwiLi4vaHRtbGJhcnMtdXRpbC90ZW1wbGF0ZS11dGlsc1wiO1xuaW1wb3J0IHZvaWRNYXAgZnJvbSAnLi4vaHRtbGJhcnMtdXRpbC92b2lkLXRhZy1uYW1lcyc7XG5cbnZhciBzdmdOYW1lc3BhY2UgPSBcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHJlbmRlcih0ZW1wbGF0ZSwgZW52LCBzY29wZSwgb3B0aW9ucykge1xuICB2YXIgZG9tID0gZW52LmRvbTtcbiAgdmFyIGNvbnRleHR1YWxFbGVtZW50O1xuXG4gIGlmIChvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMucmVuZGVyTm9kZSkge1xuICAgICAgY29udGV4dHVhbEVsZW1lbnQgPSBvcHRpb25zLnJlbmRlck5vZGUuY29udGV4dHVhbEVsZW1lbnQ7XG4gICAgfSBlbHNlIGlmIChvcHRpb25zLmNvbnRleHR1YWxFbGVtZW50KSB7XG4gICAgICBjb250ZXh0dWFsRWxlbWVudCA9IG9wdGlvbnMuY29udGV4dHVhbEVsZW1lbnQ7XG4gICAgfVxuICB9XG5cbiAgZG9tLmRldGVjdE5hbWVzcGFjZShjb250ZXh0dWFsRWxlbWVudCk7XG5cbiAgdmFyIHJlbmRlclJlc3VsdCA9IFJlbmRlclJlc3VsdC5idWlsZChlbnYsIHNjb3BlLCB0ZW1wbGF0ZSwgb3B0aW9ucywgY29udGV4dHVhbEVsZW1lbnQpO1xuICByZW5kZXJSZXN1bHQucmVuZGVyKCk7XG5cbiAgcmV0dXJuIHJlbmRlclJlc3VsdDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIFJlbmRlck9wdGlvbnMocmVuZGVyTm9kZSwgc2VsZiwgYmxvY2tBcmd1bWVudHMsIGNvbnRleHR1YWxFbGVtZW50KSB7XG4gIHRoaXMucmVuZGVyTm9kZSA9IHJlbmRlck5vZGUgfHwgbnVsbDtcbiAgdGhpcy5zZWxmID0gc2VsZjtcbiAgdGhpcy5ibG9ja0FyZ3VtZW50cyA9IGJsb2NrQXJndW1lbnRzIHx8IG51bGw7XG4gIHRoaXMuY29udGV4dHVhbEVsZW1lbnQgPSBjb250ZXh0dWFsRWxlbWVudCB8fCBudWxsO1xufVxuXG5mdW5jdGlvbiBSZW5kZXJSZXN1bHQoZW52LCBzY29wZSwgb3B0aW9ucywgcm9vdE5vZGUsIG93bmVyTm9kZSwgbm9kZXMsIGZyYWdtZW50LCB0ZW1wbGF0ZSwgc2hvdWxkU2V0Q29udGVudCkge1xuICB0aGlzLnJvb3QgPSByb290Tm9kZTtcbiAgdGhpcy5mcmFnbWVudCA9IGZyYWdtZW50O1xuXG4gIHRoaXMubm9kZXMgPSBub2RlcztcbiAgdGhpcy50ZW1wbGF0ZSA9IHRlbXBsYXRlO1xuICB0aGlzLnN0YXRlbWVudHMgPSB0ZW1wbGF0ZS5zdGF0ZW1lbnRzLnNsaWNlKCk7XG4gIHRoaXMuZW52ID0gZW52O1xuICB0aGlzLnNjb3BlID0gc2NvcGU7XG4gIHRoaXMuc2hvdWxkU2V0Q29udGVudCA9IHNob3VsZFNldENvbnRlbnQ7XG5cbiAgaWYgKG9wdGlvbnMuc2VsZiAhPT0gdW5kZWZpbmVkKSB7IHRoaXMuYmluZFNlbGYob3B0aW9ucy5zZWxmKTsgfVxuICBpZiAob3B0aW9ucy5ibG9ja0FyZ3VtZW50cyAhPT0gdW5kZWZpbmVkKSB7IHRoaXMuYmluZExvY2FscyhvcHRpb25zLmJsb2NrQXJndW1lbnRzKTsgfVxuXG4gIHRoaXMuaW5pdGlhbGl6ZU5vZGVzKG93bmVyTm9kZSk7XG59XG5cblJlbmRlclJlc3VsdC5idWlsZCA9IGZ1bmN0aW9uKGVudiwgc2NvcGUsIHRlbXBsYXRlLCBvcHRpb25zLCBjb250ZXh0dWFsRWxlbWVudCkge1xuICB2YXIgZG9tID0gZW52LmRvbTtcbiAgdmFyIGZyYWdtZW50ID0gZ2V0Q2FjaGVkRnJhZ21lbnQodGVtcGxhdGUsIGVudik7XG4gIHZhciBub2RlcyA9IHRlbXBsYXRlLmJ1aWxkUmVuZGVyTm9kZXMoZG9tLCBmcmFnbWVudCwgY29udGV4dHVhbEVsZW1lbnQpO1xuXG4gIHZhciByb290Tm9kZSwgb3duZXJOb2RlLCBzaG91bGRTZXRDb250ZW50O1xuXG4gIGlmIChvcHRpb25zICYmIG9wdGlvbnMucmVuZGVyTm9kZSkge1xuICAgIHJvb3ROb2RlID0gb3B0aW9ucy5yZW5kZXJOb2RlO1xuICAgIG93bmVyTm9kZSA9IHJvb3ROb2RlLm93bmVyTm9kZTtcbiAgICBzaG91bGRTZXRDb250ZW50ID0gdHJ1ZTtcbiAgfSBlbHNlIHtcbiAgICByb290Tm9kZSA9IGRvbS5jcmVhdGVNb3JwaChudWxsLCBmcmFnbWVudC5maXJzdENoaWxkLCBmcmFnbWVudC5sYXN0Q2hpbGQsIGNvbnRleHR1YWxFbGVtZW50KTtcbiAgICBvd25lck5vZGUgPSByb290Tm9kZTtcbiAgICByb290Tm9kZS5vd25lck5vZGUgPSBvd25lck5vZGU7XG4gICAgc2hvdWxkU2V0Q29udGVudCA9IGZhbHNlO1xuICB9XG5cbiAgaWYgKHJvb3ROb2RlLmNoaWxkTm9kZXMpIHtcbiAgICB2aXNpdENoaWxkcmVuKHJvb3ROb2RlLmNoaWxkTm9kZXMsIGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgIGNsZWFyTW9ycGgobm9kZSwgZW52LCB0cnVlKTtcbiAgICB9KTtcbiAgfVxuXG4gIHJvb3ROb2RlLmNoaWxkTm9kZXMgPSBub2RlcztcbiAgcmV0dXJuIG5ldyBSZW5kZXJSZXN1bHQoZW52LCBzY29wZSwgb3B0aW9ucywgcm9vdE5vZGUsIG93bmVyTm9kZSwgbm9kZXMsIGZyYWdtZW50LCB0ZW1wbGF0ZSwgc2hvdWxkU2V0Q29udGVudCk7XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gbWFudWFsRWxlbWVudCh0YWdOYW1lLCBhdHRyaWJ1dGVzLCBfaXNFbXB0eSkge1xuICB2YXIgc3RhdGVtZW50cyA9IFtdO1xuXG4gIGZvciAodmFyIGtleSBpbiBhdHRyaWJ1dGVzKSB7XG4gICAgaWYgKHR5cGVvZiBhdHRyaWJ1dGVzW2tleV0gPT09ICdzdHJpbmcnKSB7IGNvbnRpbnVlOyB9XG4gICAgc3RhdGVtZW50cy5wdXNoKFtcImF0dHJpYnV0ZVwiLCBrZXksIGF0dHJpYnV0ZXNba2V5XV0pO1xuICB9XG5cbiAgdmFyIGlzRW1wdHkgPSBfaXNFbXB0eSB8fCB2b2lkTWFwW3RhZ05hbWVdO1xuXG4gIGlmICghaXNFbXB0eSkge1xuICAgIHN0YXRlbWVudHMucHVzaChbJ2NvbnRlbnQnLCAneWllbGQnXSk7XG4gIH1cblxuICB2YXIgdGVtcGxhdGUgPSB7XG4gICAgYXJpdHk6IDAsXG4gICAgY2FjaGVkRnJhZ21lbnQ6IG51bGwsXG4gICAgaGFzUmVuZGVyZWQ6IGZhbHNlLFxuICAgIGJ1aWxkRnJhZ21lbnQ6IGZ1bmN0aW9uIGJ1aWxkRnJhZ21lbnQoZG9tKSB7XG4gICAgICB2YXIgZWwwID0gZG9tLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICAgIGlmICh0YWdOYW1lID09PSAnc3ZnJykge1xuICAgICAgICBkb20uc2V0TmFtZXNwYWNlKHN2Z05hbWVzcGFjZSk7XG4gICAgICB9XG4gICAgICB2YXIgZWwxID0gZG9tLmNyZWF0ZUVsZW1lbnQodGFnTmFtZSk7XG5cbiAgICAgIGZvciAodmFyIGtleSBpbiBhdHRyaWJ1dGVzKSB7XG4gICAgICAgIGlmICh0eXBlb2YgYXR0cmlidXRlc1trZXldICE9PSAnc3RyaW5nJykgeyBjb250aW51ZTsgfVxuICAgICAgICBkb20uc2V0QXR0cmlidXRlKGVsMSwga2V5LCBhdHRyaWJ1dGVzW2tleV0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWlzRW1wdHkpIHtcbiAgICAgICAgdmFyIGVsMiA9IGRvbS5jcmVhdGVDb21tZW50KFwiXCIpO1xuICAgICAgICBkb20uYXBwZW5kQ2hpbGQoZWwxLCBlbDIpO1xuICAgICAgfVxuXG4gICAgICBkb20uYXBwZW5kQ2hpbGQoZWwwLCBlbDEpO1xuXG4gICAgICByZXR1cm4gZWwwO1xuICAgIH0sXG4gICAgYnVpbGRSZW5kZXJOb2RlczogZnVuY3Rpb24gYnVpbGRSZW5kZXJOb2Rlcyhkb20sIGZyYWdtZW50KSB7XG4gICAgICB2YXIgZWxlbWVudCA9IGRvbS5jaGlsZEF0KGZyYWdtZW50LCBbMF0pO1xuICAgICAgdmFyIG1vcnBocyA9IFtdO1xuXG4gICAgICBmb3IgKHZhciBrZXkgaW4gYXR0cmlidXRlcykge1xuICAgICAgICBpZiAodHlwZW9mIGF0dHJpYnV0ZXNba2V5XSA9PT0gJ3N0cmluZycpIHsgY29udGludWU7IH1cbiAgICAgICAgbW9ycGhzLnB1c2goZG9tLmNyZWF0ZUF0dHJNb3JwaChlbGVtZW50LCBrZXkpKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFpc0VtcHR5KSB7XG4gICAgICAgIG1vcnBocy5wdXNoKGRvbS5jcmVhdGVNb3JwaEF0KGVsZW1lbnQsIDAsIDApKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG1vcnBocztcbiAgICB9LFxuICAgIHN0YXRlbWVudHM6IHN0YXRlbWVudHMsXG4gICAgbG9jYWxzOiBbXSxcbiAgICB0ZW1wbGF0ZXM6IFtdXG4gIH07XG5cbiAgcmV0dXJuIHRlbXBsYXRlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYXR0YWNoQXR0cmlidXRlcyhhdHRyaWJ1dGVzKSB7XG4gIHZhciBzdGF0ZW1lbnRzID0gW107XG5cbiAgZm9yICh2YXIga2V5IGluIGF0dHJpYnV0ZXMpIHtcbiAgICBpZiAodHlwZW9mIGF0dHJpYnV0ZXNba2V5XSA9PT0gJ3N0cmluZycpIHsgY29udGludWU7IH1cbiAgICBzdGF0ZW1lbnRzLnB1c2goW1wiYXR0cmlidXRlXCIsIGtleSwgYXR0cmlidXRlc1trZXldXSk7XG4gIH1cblxuICB2YXIgdGVtcGxhdGUgPSB7XG4gICAgYXJpdHk6IDAsXG4gICAgY2FjaGVkRnJhZ21lbnQ6IG51bGwsXG4gICAgaGFzUmVuZGVyZWQ6IGZhbHNlLFxuICAgIGJ1aWxkRnJhZ21lbnQ6IGZ1bmN0aW9uIGJ1aWxkRnJhZ21lbnQoZG9tKSB7XG4gICAgICB2YXIgZWwwID0gdGhpcy5lbGVtZW50O1xuICAgICAgaWYgKGVsMC5uYW1lc3BhY2VVUkkgPT09IFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIikge1xuICAgICAgICBkb20uc2V0TmFtZXNwYWNlKHN2Z05hbWVzcGFjZSk7XG4gICAgICB9XG4gICAgICBmb3IgKHZhciBrZXkgaW4gYXR0cmlidXRlcykge1xuICAgICAgICBpZiAodHlwZW9mIGF0dHJpYnV0ZXNba2V5XSAhPT0gJ3N0cmluZycpIHsgY29udGludWU7IH1cbiAgICAgICAgZG9tLnNldEF0dHJpYnV0ZShlbDAsIGtleSwgYXR0cmlidXRlc1trZXldKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGVsMDtcbiAgICB9LFxuICAgIGJ1aWxkUmVuZGVyTm9kZXM6IGZ1bmN0aW9uIGJ1aWxkUmVuZGVyTm9kZXMoZG9tKSB7XG4gICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudDtcbiAgICAgIHZhciBtb3JwaHMgPSBbXTtcblxuICAgICAgZm9yICh2YXIga2V5IGluIGF0dHJpYnV0ZXMpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBhdHRyaWJ1dGVzW2tleV0gPT09ICdzdHJpbmcnKSB7IGNvbnRpbnVlOyB9XG4gICAgICAgIG1vcnBocy5wdXNoKGRvbS5jcmVhdGVBdHRyTW9ycGgoZWxlbWVudCwga2V5KSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBtb3JwaHM7XG4gICAgfSxcbiAgICBzdGF0ZW1lbnRzOiBzdGF0ZW1lbnRzLFxuICAgIGxvY2FsczogW10sXG4gICAgdGVtcGxhdGVzOiBbXSxcbiAgICBlbGVtZW50OiBudWxsXG4gIH07XG5cbiAgcmV0dXJuIHRlbXBsYXRlO1xufVxuXG5SZW5kZXJSZXN1bHQucHJvdG90eXBlLmluaXRpYWxpemVOb2RlcyA9IGZ1bmN0aW9uKG93bmVyTm9kZSkge1xuICBsZXQgY2hpbGROb2RlcyA9IHRoaXMucm9vdC5jaGlsZE5vZGVzO1xuXG4gIGZvciAobGV0IGk9MCwgbD1jaGlsZE5vZGVzLmxlbmd0aDsgaTxsOyBpKyspIHtcbiAgICBjaGlsZE5vZGVzW2ldLm93bmVyTm9kZSA9IG93bmVyTm9kZTtcbiAgfVxufTtcblxuUmVuZGVyUmVzdWx0LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5yb290Lmxhc3RSZXN1bHQgPSB0aGlzO1xuICB0aGlzLnJvb3QucmVuZGVyZWQgPSB0cnVlO1xuICB0aGlzLnBvcHVsYXRlTm9kZXMoQWx3YXlzRGlydHlWaXNpdG9yKTtcblxuICBpZiAodGhpcy5zaG91bGRTZXRDb250ZW50ICYmIHRoaXMucm9vdC5zZXRDb250ZW50KSB7XG4gICAgdGhpcy5yb290LnNldENvbnRlbnQodGhpcy5mcmFnbWVudCk7XG4gIH1cbn07XG5cblJlbmRlclJlc3VsdC5wcm90b3R5cGUuZGlydHkgPSBmdW5jdGlvbigpIHtcbiAgdmlzaXRDaGlsZHJlbihbdGhpcy5yb290XSwgZnVuY3Rpb24obm9kZSkgeyBub2RlLmlzRGlydHkgPSB0cnVlOyB9KTtcbn07XG5cblJlbmRlclJlc3VsdC5wcm90b3R5cGUucmV2YWxpZGF0ZSA9IGZ1bmN0aW9uKGVudiwgc2VsZiwgYmxvY2tBcmd1bWVudHMsIHNjb3BlKSB7XG4gIHRoaXMucmV2YWxpZGF0ZVdpdGgoZW52LCBzY29wZSwgc2VsZiwgYmxvY2tBcmd1bWVudHMsIEV4cHJlc3Npb25WaXNpdG9yKTtcbn07XG5cblJlbmRlclJlc3VsdC5wcm90b3R5cGUucmVyZW5kZXIgPSBmdW5jdGlvbihlbnYsIHNlbGYsIGJsb2NrQXJndW1lbnRzLCBzY29wZSkge1xuICB0aGlzLnJldmFsaWRhdGVXaXRoKGVudiwgc2NvcGUsIHNlbGYsIGJsb2NrQXJndW1lbnRzLCBBbHdheXNEaXJ0eVZpc2l0b3IpO1xufTtcblxuUmVuZGVyUmVzdWx0LnByb3RvdHlwZS5yZXZhbGlkYXRlV2l0aCA9IGZ1bmN0aW9uKGVudiwgc2NvcGUsIHNlbGYsIGJsb2NrQXJndW1lbnRzLCB2aXNpdG9yKSB7XG4gIGlmIChlbnYgIT09IHVuZGVmaW5lZCkgeyB0aGlzLmVudiA9IGVudjsgfVxuICBpZiAoc2NvcGUgIT09IHVuZGVmaW5lZCkgeyB0aGlzLnNjb3BlID0gc2NvcGU7IH1cbiAgdGhpcy51cGRhdGVTY29wZSgpO1xuXG4gIGlmIChzZWxmICE9PSB1bmRlZmluZWQpIHsgdGhpcy51cGRhdGVTZWxmKHNlbGYpOyB9XG4gIGlmIChibG9ja0FyZ3VtZW50cyAhPT0gdW5kZWZpbmVkKSB7IHRoaXMudXBkYXRlTG9jYWxzKGJsb2NrQXJndW1lbnRzKTsgfVxuXG4gIHRoaXMucG9wdWxhdGVOb2Rlcyh2aXNpdG9yKTtcbn07XG5cblJlbmRlclJlc3VsdC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkge1xuICB2YXIgcm9vdE5vZGUgPSB0aGlzLnJvb3Q7XG4gIGNsZWFyTW9ycGgocm9vdE5vZGUsIHRoaXMuZW52LCB0cnVlKTtcbn07XG5cblJlbmRlclJlc3VsdC5wcm90b3R5cGUucG9wdWxhdGVOb2RlcyA9IGZ1bmN0aW9uKHZpc2l0b3IpIHtcbiAgdmFyIGVudiA9IHRoaXMuZW52O1xuICB2YXIgc2NvcGUgPSB0aGlzLnNjb3BlO1xuICB2YXIgdGVtcGxhdGUgPSB0aGlzLnRlbXBsYXRlO1xuICB2YXIgbm9kZXMgPSB0aGlzLm5vZGVzO1xuICB2YXIgc3RhdGVtZW50cyA9IHRoaXMuc3RhdGVtZW50cztcbiAgdmFyIGksIGw7XG5cbiAgZm9yIChpPTAsIGw9c3RhdGVtZW50cy5sZW5ndGg7IGk8bDsgaSsrKSB7XG4gICAgdmFyIHN0YXRlbWVudCA9IHN0YXRlbWVudHNbaV07XG4gICAgdmFyIG1vcnBoID0gbm9kZXNbaV07XG5cbiAgICBpZiAoZW52Lmhvb2tzLndpbGxSZW5kZXJOb2RlKSB7XG4gICAgICBlbnYuaG9va3Mud2lsbFJlbmRlck5vZGUobW9ycGgsIGVudiwgc2NvcGUpO1xuICAgIH1cblxuICAgIHN3aXRjaCAoc3RhdGVtZW50WzBdKSB7XG4gICAgICBjYXNlICdibG9jayc6IHZpc2l0b3IuYmxvY2soc3RhdGVtZW50LCBtb3JwaCwgZW52LCBzY29wZSwgdGVtcGxhdGUsIHZpc2l0b3IpOyBicmVhaztcbiAgICAgIGNhc2UgJ2lubGluZSc6IHZpc2l0b3IuaW5saW5lKHN0YXRlbWVudCwgbW9ycGgsIGVudiwgc2NvcGUsIHZpc2l0b3IpOyBicmVhaztcbiAgICAgIGNhc2UgJ2NvbnRlbnQnOiB2aXNpdG9yLmNvbnRlbnQoc3RhdGVtZW50LCBtb3JwaCwgZW52LCBzY29wZSwgdmlzaXRvcik7IGJyZWFrO1xuICAgICAgY2FzZSAnZWxlbWVudCc6IHZpc2l0b3IuZWxlbWVudChzdGF0ZW1lbnQsIG1vcnBoLCBlbnYsIHNjb3BlLCB0ZW1wbGF0ZSwgdmlzaXRvcik7IGJyZWFrO1xuICAgICAgY2FzZSAnYXR0cmlidXRlJzogdmlzaXRvci5hdHRyaWJ1dGUoc3RhdGVtZW50LCBtb3JwaCwgZW52LCBzY29wZSk7IGJyZWFrO1xuICAgICAgY2FzZSAnY29tcG9uZW50JzogdmlzaXRvci5jb21wb25lbnQoc3RhdGVtZW50LCBtb3JwaCwgZW52LCBzY29wZSwgdGVtcGxhdGUsIHZpc2l0b3IpOyBicmVhaztcbiAgICB9XG5cbiAgICBpZiAoZW52Lmhvb2tzLmRpZFJlbmRlck5vZGUpIHtcbiAgICAgIGVudi5ob29rcy5kaWRSZW5kZXJOb2RlKG1vcnBoLCBlbnYsIHNjb3BlKTtcbiAgICB9XG4gIH1cbn07XG5cblJlbmRlclJlc3VsdC5wcm90b3R5cGUuYmluZFNjb3BlID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuZW52Lmhvb2tzLmJpbmRTY29wZSh0aGlzLmVudiwgdGhpcy5zY29wZSk7XG59O1xuXG5SZW5kZXJSZXN1bHQucHJvdG90eXBlLnVwZGF0ZVNjb3BlID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuZW52Lmhvb2tzLnVwZGF0ZVNjb3BlKHRoaXMuZW52LCB0aGlzLnNjb3BlKTtcbn07XG5cblJlbmRlclJlc3VsdC5wcm90b3R5cGUuYmluZFNlbGYgPSBmdW5jdGlvbihzZWxmKSB7XG4gIHRoaXMuZW52Lmhvb2tzLmJpbmRTZWxmKHRoaXMuZW52LCB0aGlzLnNjb3BlLCBzZWxmKTtcbn07XG5cblJlbmRlclJlc3VsdC5wcm90b3R5cGUudXBkYXRlU2VsZiA9IGZ1bmN0aW9uKHNlbGYpIHtcbiAgdGhpcy5lbnYuaG9va3MudXBkYXRlU2VsZih0aGlzLmVudiwgdGhpcy5zY29wZSwgc2VsZik7XG59O1xuXG5SZW5kZXJSZXN1bHQucHJvdG90eXBlLmJpbmRMb2NhbHMgPSBmdW5jdGlvbihibG9ja0FyZ3VtZW50cykge1xuICB2YXIgbG9jYWxOYW1lcyA9IHRoaXMudGVtcGxhdGUubG9jYWxzO1xuXG4gIGZvciAodmFyIGk9MCwgbD1sb2NhbE5hbWVzLmxlbmd0aDsgaTxsOyBpKyspIHtcbiAgICB0aGlzLmVudi5ob29rcy5iaW5kTG9jYWwodGhpcy5lbnYsIHRoaXMuc2NvcGUsIGxvY2FsTmFtZXNbaV0sIGJsb2NrQXJndW1lbnRzW2ldKTtcbiAgfVxufTtcblxuUmVuZGVyUmVzdWx0LnByb3RvdHlwZS51cGRhdGVMb2NhbHMgPSBmdW5jdGlvbihibG9ja0FyZ3VtZW50cykge1xuICB2YXIgbG9jYWxOYW1lcyA9IHRoaXMudGVtcGxhdGUubG9jYWxzO1xuXG4gIGZvciAodmFyIGk9MCwgbD1sb2NhbE5hbWVzLmxlbmd0aDsgaTxsOyBpKyspIHtcbiAgICB0aGlzLmVudi5ob29rcy51cGRhdGVMb2NhbCh0aGlzLmVudiwgdGhpcy5zY29wZSwgbG9jYWxOYW1lc1tpXSwgYmxvY2tBcmd1bWVudHNbaV0pO1xuICB9XG59O1xuXG5mdW5jdGlvbiBpbml0aWFsaXplTm9kZShub2RlLCBvd25lcikge1xuICBub2RlLm93bmVyTm9kZSA9IG93bmVyO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQ2hpbGRNb3JwaChkb20sIHBhcmVudE1vcnBoLCBjb250ZXh0dWFsRWxlbWVudCkge1xuICB2YXIgbW9ycGggPSBNb3JwaC5lbXB0eShkb20sIGNvbnRleHR1YWxFbGVtZW50IHx8IHBhcmVudE1vcnBoLmNvbnRleHR1YWxFbGVtZW50KTtcbiAgaW5pdGlhbGl6ZU5vZGUobW9ycGgsIHBhcmVudE1vcnBoLm93bmVyTm9kZSk7XG4gIHJldHVybiBtb3JwaDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldENhY2hlZEZyYWdtZW50KHRlbXBsYXRlLCBlbnYpIHtcbiAgdmFyIGRvbSA9IGVudi5kb20sIGZyYWdtZW50O1xuICBpZiAoZW52LnVzZUZyYWdtZW50Q2FjaGUgJiYgZG9tLmNhbkNsb25lKSB7XG4gICAgaWYgKHRlbXBsYXRlLmNhY2hlZEZyYWdtZW50ID09PSBudWxsKSB7XG4gICAgICBmcmFnbWVudCA9IHRlbXBsYXRlLmJ1aWxkRnJhZ21lbnQoZG9tKTtcbiAgICAgIGlmICh0ZW1wbGF0ZS5oYXNSZW5kZXJlZCkge1xuICAgICAgICB0ZW1wbGF0ZS5jYWNoZWRGcmFnbWVudCA9IGZyYWdtZW50O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGVtcGxhdGUuaGFzUmVuZGVyZWQgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAodGVtcGxhdGUuY2FjaGVkRnJhZ21lbnQpIHtcbiAgICAgIGZyYWdtZW50ID0gZG9tLmNsb25lTm9kZSh0ZW1wbGF0ZS5jYWNoZWRGcmFnbWVudCwgdHJ1ZSk7XG4gICAgfVxuICB9IGVsc2UgaWYgKCFmcmFnbWVudCkge1xuICAgIGZyYWdtZW50ID0gdGVtcGxhdGUuYnVpbGRGcmFnbWVudChkb20pO1xuICB9XG5cbiAgcmV0dXJuIGZyYWdtZW50O1xufVxuIl19